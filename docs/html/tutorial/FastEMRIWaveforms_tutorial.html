<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fast and Accurate EMRI Waveforms Tutorial &mdash; few: Fast EMRI Waveforms 0.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Single Mode Frequency Domain Waveform Construction" href="Tutorial_FD_construction_single_mode.html" />
    <link rel="prev" title="Citations" href="../user/cite.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: coral" >
            <a href="../index.html" class="icon icon-home"> few: Fast EMRI Waveforms
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/main.html">Overall Waveform Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/traj.html">Trajectory Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/amp.html">Amplitude Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/sum.html">Summation Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/util.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/cite.html">Citations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fast and Accurate EMRI Waveforms Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Full-EMRI-Waveforms-in-Schwarzschild-Eccentric">Full EMRI Waveforms in Schwarzschild Eccentric</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#FastSchwarzschildEccentricFlux">FastSchwarzschildEccentricFlux</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Waveform-scaled-by-distance-(generated-in-source-frame)">Waveform scaled by distance (generated in source frame)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Producing-waveforms-with-the-generic-interface">Producing waveforms with the generic interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#SlowSchwarzschildEccentricFlux">SlowSchwarzschildEccentricFlux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Trajectory-Module">Trajectory Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Run-a-basic-trajectory">Run a basic trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Defining-a-new-t-vector">Defining a new t vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Defining-dt-and-T">Defining dt and T</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Getting-dimensionless-time-(t/M)">Getting dimensionless time (<span class="math notranslate nohighlight">\(t/M\)</span>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Dense-Stepping">Dense Stepping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Amplitude-Module">Amplitude Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ROMAN-amplitude-generation">ROMAN amplitude generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Interpolate-modes-with-bicubic-spline">Interpolate modes with bicubic spline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Spin-weighted-spherical-harmonics">Spin-weighted spherical harmonics</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Mode-Selection">Mode Selection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Mode-selection-by-power-contribution">Mode selection by power contribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Mode-selection-by-noise-weighted-power-contribution">Mode selection by noise-weighted power contribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Compare-the-two-waves-with-and-without-noise-weighting">Compare the two waves with and without noise-weighting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Specific-mode-selection">Specific mode selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Turn-off-(-m)">Turn off (<span class="math notranslate nohighlight">\(-m\)</span>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Parallelized-Cubic-Spline-Interpolation">Parallelized Cubic Spline Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Mode-Summation">Mode Summation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Interpolated-summation">Interpolated summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Direct-summation">Direct summation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Utility-functions">Utility functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Get-options-for-installed-ODE-functions">Get options for installed ODE functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Fundamental-Frequencies">Fundamental Frequencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Separatrix-in-Generic-Kerr">Separatrix in Generic Kerr</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Get-Kerr-Constants-of-Motion-(E,-L,-Q)">Get Kerr Constants of Motion <span class="math notranslate nohighlight">\((E, L, Q)\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Convert-from-x_I-to-Y">Convert from <span class="math notranslate nohighlight">\(x_I\)</span> to <span class="math notranslate nohighlight">\(Y\)</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="#Get-\mu-based-on-desired-duration-of-waveform">Get <span class="math notranslate nohighlight">\(\mu\)</span> based on desired duration of waveform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Get-p_0-based-on-desired-duration-of-waveform">Get <span class="math notranslate nohighlight">\(p_0\)</span> based on desired duration of waveform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Change-CUDA-device">Change CUDA device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Creating-modules">Creating modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Post-Newtonian-trajectory">Post-Newtonian trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Test-your-trajectory">Test your trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Implement-ODE-in-C/C++">Implement ODE in C/C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Analytic-functions-that-do-not-need-storage">Analytic functions that do not need storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Functions-that-require-storage">Functions that require storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Make-a-waveform-model">Make a waveform model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Test-your-waveform">Test your waveform</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Augmented-Analytic-Kludge-with-5PN-trajectory">Augmented Analytic Kludge with 5PN trajectory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#5PN-Trajectory">5PN Trajectory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Building-an-AAK-waveform-from-a-given-trajectory-(in-this-case-the-5PN-trajectory)">Building an AAK waveform from a given trajectory (in this case the 5PN trajectory)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-the-new-AAK-with-the-generic-waveform-generator">Generating the new AAK with the generic waveform generator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Citing-waveforms-and-modules">Citing waveforms and modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Fast-Schwarzschild-Eccentric-Waveforms">Fast Schwarzschild Eccentric Waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#New-and-Improved-AAK-with-5PN-Trajectory">New and Improved AAK with 5PN Trajectory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial_FD_construction_single_mode.html">Single Mode Frequency Domain Waveform Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial_FrequencyDomain_Waveforms.html">EMRI Waveforms in frequency domain</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">General Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general/docs_main.html">FastEMRIWaveforms Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/docs_main.html#package-todos">Package TODOs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/docs_main.html#change-log">Change Log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: coral" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">few: Fast EMRI Waveforms</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Fast and Accurate EMRI Waveforms Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorial/FastEMRIWaveforms_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="../user/cite.html" class="btn btn-neutral float-left" title="Citations" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tutorial_FD_construction_single_mode.html" class="btn btn-neutral float-right" title="Single Mode Frequency Domain Waveform Construction" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Fast-and-Accurate-EMRI-Waveforms-Tutorial">
<h1>Fast and Accurate EMRI Waveforms Tutorial<a class="headerlink" href="#Fast-and-Accurate-EMRI-Waveforms-Tutorial" title="Permalink to this heading"></a></h1>
<p>Here we provide a set of examples for creating EMRI waveforms as a whole; looking at separate creation pieces (trajectory, amplitude, summation, etc.); and creating your own module to build directly into this framework. For details on the specifics of our waveforms like constructions used and generally methodology, we refer you to our papers <a class="reference external" href="https://arxiv.org/abs/2104.04582">arxiv.org/2104.04582</a> and <a class="reference external" href="https://arxiv.org/abs/2008.06071">arxiv.org/2008.06071</a> and the <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/">package
documentation</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">few.trajectory.inspiral</span> <span class="kn">import</span> <span class="n">EMRIInspiral</span>
<span class="kn">from</span> <span class="nn">few.amplitude.romannet</span> <span class="kn">import</span> <span class="n">RomanAmplitude</span>
<span class="kn">from</span> <span class="nn">few.amplitude.interp2dcubicspline</span> <span class="kn">import</span> <span class="n">Interp2DAmplitude</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">,</span> <span class="n">SlowSchwarzschildEccentricFlux</span><span class="p">,</span> <span class="n">GenerateEMRIWaveform</span>
<span class="kn">from</span> <span class="nn">few.utils.utility</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_overlap</span><span class="p">,</span>
                               <span class="n">get_mismatch</span><span class="p">,</span>
                               <span class="n">get_fundamental_frequencies</span><span class="p">,</span>
                               <span class="n">get_separatrix</span><span class="p">,</span>
                               <span class="n">get_mu_at_t</span><span class="p">,</span>
                               <span class="n">get_p_at_t</span><span class="p">,</span>
                               <span class="n">get_kerr_geo_constants_of_motion</span><span class="p">,</span>
                               <span class="n">xI_to_Y</span><span class="p">,</span>
                               <span class="n">Y_to_xI</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">few.utils.ylm</span> <span class="kn">import</span> <span class="n">GetYlms</span>
<span class="kn">from</span> <span class="nn">few.utils.modeselector</span> <span class="kn">import</span> <span class="n">ModeSelector</span>
<span class="kn">from</span> <span class="nn">few.summation.interpolatedmodesum</span> <span class="kn">import</span> <span class="n">CubicSplineInterpolant</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">SchwarzschildEccentricWaveformBase</span>
<span class="kn">from</span> <span class="nn">few.summation.interpolatedmodesum</span> <span class="kn">import</span> <span class="n">InterpolatedModeSum</span>
<span class="kn">from</span> <span class="nn">few.summation.directmodesum</span> <span class="kn">import</span> <span class="n">DirectModeSum</span>
<span class="kn">from</span> <span class="nn">few.utils.constants</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">few.summation.aakwave</span> <span class="kn">import</span> <span class="n">AAKSummation</span>
<span class="kn">from</span> <span class="nn">few.waveform</span> <span class="kn">import</span> <span class="n">Pn5AAKWaveform</span><span class="p">,</span> <span class="n">AAKWaveformBase</span>
</pre></div>
</div>
</div>
</section>
<section id="Full-EMRI-Waveforms-in-Schwarzschild-Eccentric">
<h1>Full EMRI Waveforms in Schwarzschild Eccentric<a class="headerlink" href="#Full-EMRI-Waveforms-in-Schwarzschild-Eccentric" title="Permalink to this heading"></a></h1>
<p>In the section, we will describe how to create EMRI waveforms with both our fast and slow EMRI waveform model. The current full models include <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.FastSchwarzschildEccentricFlux">FastSchwarzschildEccentricFlux</a> and <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.SlowSchwarzschildEccentricFlux">SlowSchwarzschildEccentricFlux</a>. These are fast and slow versions of models that evolve eccentric
flux-based trajectories in a Schwarzschild background. The fast model can be run exactly as shown here on CPUs or GPUs by providing the correct initialization arguments.</p>
<p>The waveform model produces <span class="math notranslate nohighlight">\(h(t) = h_p - ih_c(t)\)</span>. It takes as arguments <span class="math notranslate nohighlight">\(\{M, \mu, p_0, e_0, \Phi_{\phi,0}, \Phi_{r, 0}\}\)</span>. <span class="math notranslate nohighlight">\(M\)</span> is the larger mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(\mu\)</span> is the compact object mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(p_0\)</span> is the initial semi-latus rectum (dimensionless), <span class="math notranslate nohighlight">\(e_0\)</span> is the initial eccentricity, and the final two are the initial phases in <span class="math notranslate nohighlight">\(\phi, r\)</span>.</p>
<section id="FastSchwarzschildEccentricFlux">
<h2><a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.FastSchwarzschildEccentricFlux">FastSchwarzschildEccentricFlux</a><a class="headerlink" href="#FastSchwarzschildEccentricFlux" title="Permalink to this heading"></a></h2>
<p>The fast waveform generates sparse trajectories with ~100 points. Amplitudes for all modes are then determined with ROMAN network. From these amplitudes, we perform mode selection to remove modes that do not contribute significantly to the waveform. The remaining modes and phases are then interpolated with cubic splines. In one final step, the amplitude, phase, and angular harmonic information is then combined with an interpolated summation.</p>
<ul class="simple">
<li><p>Trajectory Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/traj.html#few.trajectory.flux.RunSchwarzEccFluxInspiral">RunSchwarzEccFluxInspiral</a></p></li>
<li><p>Amplitude Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/amp.html#few.amplitude.romannet.RomanAmplitude">RomanAmplitude</a></p></li>
<li><p>Summation Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/sum.html#few.summation.interpolatedmodesum.CubicSplineInterpolant">InterpolateModeSum</a></p></li>
<li><p>Mode Selection: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/util.html#few.utils.modeselector.ModeSelector">ModeSelector</a></p></li>
<li><p>Angular Harmonics: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/util.html#few.utils.ylm.GetYlms">GetYlms</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># keyword arguments for inspiral generator (RunSchwarzEccFluxInspiral)</span>
<span class="n">inspiral_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;DENSE_STEPPING&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># we want a sparsely sampled trajectory</span>
        <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
    <span class="p">}</span>

<span class="c1"># keyword arguments for inspiral generator (RomanAmplitude)</span>
<span class="n">amplitude_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span>  <span class="c1"># GPU is available in this class</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for Ylm generator (GetYlms)</span>
<span class="n">Ylm_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;assume_positive_m&quot;</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># if we assume positive m, it will generate negative m for all m&gt;0</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for summation generator (InterpolatedModeSum)</span>
<span class="n">sum_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span><span class="p">,</span>  <span class="c1"># GPU is availabel for this type of summation</span>
    <span class="s2">&quot;pad_output&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">few</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">(</span>
    <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
    <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
    <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1">#  assumes dt = 10.0 for max T = 1.0 year</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="mi">1000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x178db7880&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_9_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:],</span> <span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:],</span> <span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x178e94580&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_10_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_10_1.png" />
</div>
</div>
<p>To get shorter waveforms, you can provide the <code class="docutils literal notranslate"><span class="pre">T</span></code> kwarg for the function call. This is the observation time in years. You can also adjust <code class="docutils literal notranslate"><span class="pre">dt</span></code>. This is the time change in samples in seconds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">8.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># seconds</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># years</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># we can check how many harmonic modes are kept</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

<span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
85300.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_12_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_12_1.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">eps</span></code> kwarg will change the mode content of the waveform. Lowering it add modes. Increasing it will remove modes. The default is <span class="math notranslate nohighlight">\(10^{-5}\)</span>. This is generally recommended as good setting for good overlaps across the available parameter space.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span> <span class="c1"># seconds</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># years</span>
<span class="n">wave1</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>  <span class="c1"># default</span>

<span class="c1"># we can check how many harmonic modes are kept</span>
<span class="n">modes1</span> <span class="o">=</span> <span class="n">few</span><span class="o">.</span><span class="n">num_modes_kept</span>

<span class="n">wave2</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>

<span class="n">modes2</span> <span class="o">=</span> <span class="n">few</span><span class="o">.</span><span class="n">num_modes_kept</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave1</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$10^{-5}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave2</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$10^{-2}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># we can also compute the mismatch when removing modes</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">)</span>

<span class="c1"># we can check how many modes were kept</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wave1 used </span><span class="si">{}</span><span class="s1"> modes. wave2 used </span><span class="si">{}</span><span class="s1"> modes. The mismatch was </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modes1</span><span class="p">,</span> <span class="n">modes2</span><span class="p">,</span> <span class="n">mm</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
wave1 used 451 modes. wave2 used 25 modes. The mismatch was 0.0012120661717401893
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_14_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_14_1.png" />
</div>
</div>
</section>
<section id="Waveform-scaled-by-distance-(generated-in-source-frame)">
<h2>Waveform scaled by distance (generated in source frame)<a class="headerlink" href="#Waveform-scaled-by-distance-(generated-in-source-frame)" title="Permalink to this heading"></a></h2>
<p>The FastSchwarzschildEccentricFlux waveform is generated with source frame viewing angles. For all previous examples, the <code class="docutils literal notranslate"><span class="pre">dist</span></code> kwarg was left blank. To scale the waveform by the distance, you can add the distance in Gpc as a kwarg in the waveform generation class.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">8.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance in Gpc</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># seconds</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># years</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># we can check how many harmonic modes are kept</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">wave</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x1790840a0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_17_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_17_1.png" />
</div>
</div>
</section>
<section id="Producing-waveforms-with-the-generic-interface">
<h2>Producing waveforms with the generic interface<a class="headerlink" href="#Producing-waveforms-with-the-generic-interface" title="Permalink to this heading"></a></h2>
<p>Waveforms can also be generated through a generic interface (<a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.GenerateEMRIWaveform">GenerateEMRIWaveform</a>) where the specific waveform model is chosen with an argument. This can also be used to produce waveforms in the detector frame used for data analysis. This interface includes all EMRI parameters, including spin and inclination, as well as sky and orientation parameters. When a specific waveform model does not
require certain parameters, the parameters will not affect the waveform generation. A detector-frame waveform in this case means <span class="math notranslate nohighlight">\(h_+,h_x\)</span> in the SSB-frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_wave</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span><span class="s2">&quot;FastSchwarzschildEccentricFlux&quot;</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># seconds</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># will be ignored in Schwarzschild waveform</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># will be ignored in Schwarzschild waveform</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># polar spin angle</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># polar sky angle</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">p0</span><span class="p">,</span>
    <span class="n">e0</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">qS</span><span class="p">,</span>
    <span class="n">phiS</span><span class="p">,</span>
    <span class="n">qK</span><span class="p">,</span>
    <span class="n">phiK</span><span class="p">,</span>
    <span class="n">Phi_phi0</span><span class="p">,</span>
    <span class="n">Phi_theta0</span><span class="p">,</span>
    <span class="n">Phi_r0</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">2000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x179731150&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_20_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_20_1.png" />
</div>
</div>
</section>
<section id="SlowSchwarzschildEccentricFlux">
<h2><a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html#few.waveform.SlowSchwarzschildEccentricFlux">SlowSchwarzschildEccentricFlux</a><a class="headerlink" href="#SlowSchwarzschildEccentricFlux" title="Permalink to this heading"></a></h2>
<p>The slow waveform generates dense trajectories with at every <code class="docutils literal notranslate"><span class="pre">dt</span></code> seconds within <code class="docutils literal notranslate"><span class="pre">T</span></code> years. Amplitudes for all modes are then determined with a 2d bicubic spline over semi-latus rectum and eccentricity for each mode. This is done at each dense time step. We do not perform mode selection because this is the slow and most accurate model against which we compare the fast model. The final summation is a direct combination of phase, amplitude, and Ylm information at each dense timestep.</p>
<p><strong>Note</strong>: One thing to pay attention to with the slow waveform is batch size. This is determined by memory limits. Usually anything under ~10000 is fine.</p>
<ul class="simple">
<li><p>Trajectory Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/traj.html#few.trajectory.flux.RunSchwarzEccFluxInspiral">RunSchwarzEccFluxInspiral</a></p></li>
<li><p>Amplitude Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/amp.html#few.amplitude.interp2dcubicspline.Interp2DAmplitude">Interp2DAmplitude</a></p></li>
<li><p>Summation Module: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/sum.html#few.summation.directmodesum.DirectModeSum">DirectModeSum</a></p></li>
<li><p>Mode Selection: None</p></li>
<li><p>Angular Harmonics: <a class="reference external" href="https://bhptoolkit.org/FastEMRIWaveforms/html/user/util.html#few.utils.ylm.GetYlms">GetYlms</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># keyword arguments for inspiral generator (RunSchwarzEccFluxInspiral)</span>
<span class="n">inspiral_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;DENSE_STEPPING&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># we want a sparsely sampled trajectory</span>
        <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">),</span>  <span class="c1"># dense stepping trajectories</span>
    <span class="p">}</span>

<span class="c1"># keyword arguments for inspiral generator (RomanAmplitude)</span>
<span class="n">amplitude_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span>  <span class="c1"># this must be &gt;= batch_size</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for Ylm generator (GetYlms)</span>
<span class="n">Ylm_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;assume_positive_m&quot;</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># if we assume positive m, it will generate negative m for all m&gt;0</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for summation generator (InterpolatedModeSum)</span>
<span class="n">sum_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span>  <span class="c1"># GPU is available for this type of summation</span>
<span class="p">}</span>

<span class="n">slow</span> <span class="o">=</span> <span class="n">SlowSchwarzschildEccentricFlux</span><span class="p">(</span>
    <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
    <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
    <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span> <span class="c1"># seconds</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">8.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>  <span class="c1"># polar viewing angle</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance in Gpc</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)</span>

<span class="n">slow_wave</span> <span class="o">=</span> <span class="n">slow</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">mode_selection</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fast_wave</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slow_wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fast_wave</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Length check:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fast_wave</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">slow_wave</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mismatch:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">slow_wave</span><span class="p">,</span> <span class="n">fast_wave</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length check: 10520 10520
Mismatch: 2.308998239208826e-05
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_24_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_24_1.png" />
</div>
</div>
</section>
</section>
<section id="Trajectory-Module">
<h1>Trajectory Module<a class="headerlink" href="#Trajectory-Module" title="Permalink to this heading"></a></h1>
<p>The trajectory module generates orbital and phase trajectories, <span class="math notranslate nohighlight">\(G(t)\)</span>, for an EMRI orbit:</p>
<p><span class="math">\begin{equation}
G(t) = \{p(t), e(t), \iota(t), \Phi_\phi(t), \Phi_\theta(t), \Phi_r(t)\}
\end{equation}</span></p>
<p>with inputs <span class="math notranslate nohighlight">\(M, \mu, p_0, e_0, \iota_0, \Phi_{\phi,0}, \Phi_{\theta,0}, \Phi_{r, 0}\)</span>. <span class="math notranslate nohighlight">\(M\)</span> is the larger mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(\mu\)</span> is the compact object mass (<span class="math notranslate nohighlight">\(M_\odot\)</span>), <span class="math notranslate nohighlight">\(p_0\)</span> is the initial semi-latus rectum (dimensionless), <span class="math notranslate nohighlight">\(e_0\)</span> is the initial eccentricity, and the final three are the initial phases in <span class="math notranslate nohighlight">\(\phi, \theta, r\)</span>. When working in equatorial orbits, <span class="math notranslate nohighlight">\(\iota(t)\)</span> and <span class="math notranslate nohighlight">\(\Phi_\theta(t)\)</span> are zero. The trajectory module also produces the
gravitational wave flux for normalization information.</p>
<section id="Run-a-basic-trajectory">
<h2>Run a basic trajectory<a class="headerlink" href="#Run-a-basic-trajectory" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># run trajectory</span>
<span class="c1"># must include for generic inputs, will fix a = 0 and x = 1.0</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Flux&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_30_0.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_30_0.png" />
</div>
</div>
</section>
<section id="Defining-a-new-t-vector">
<h2>Defining a new t vector<a class="headerlink" href="#Defining-a-new-t-vector" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># a warning will be thrown if the new_t array goes beyond the time array output from the trajectory</span>
<span class="n">t1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">Phi_phi1</span><span class="p">,</span> <span class="n">Phi_theta1</span><span class="p">,</span> <span class="n">Phi_r1</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">new_t</span><span class="o">=</span><span class="n">new_t</span><span class="p">,</span> <span class="n">upsample</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># you can cut the excess on these arrays by setting fix_t to True</span>
<span class="n">t2</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">Phi_phi2</span><span class="p">,</span> <span class="n">Phi_theta2</span><span class="p">,</span> <span class="n">Phi_r2</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">new_t</span><span class="o">=</span><span class="n">new_t</span><span class="p">,</span> <span class="n">upsample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">Phi_phi1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">Phi_r1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t1 max:&#39;</span><span class="p">,</span> <span class="n">t1</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s1">&#39;t2 max:&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mlkatz1/miniconda3/envs/test_few/lib/python3.10/site-packages/few/utils/baseclasses.py:725: UserWarning: new_t array goes beyond generated t array. If you want to cut the t array at the end of the trajectory, set fix_t to True.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
t1 max: 999999.0 t2 max: 464363.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_32_2.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_32_2.png" />
</div>
</div>
</section>
<section id="Defining-dt-and-T">
<h2>Defining dt and T<a class="headerlink" href="#Defining-dt-and-T" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="c1"># years</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">upsample</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fix_t</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x179f56410&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_34_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_34_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
157785.0
</pre></div></div>
</div>
</section>
<section id="Getting-dimensionless-time-(t/M)">
<h2>Getting dimensionless time (<span class="math notranslate nohighlight">\(t/M\)</span>)<a class="headerlink" href="#Getting-dimensionless-time-(t/M)" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">in_coordinate_time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dimensionless time step:&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dimensionless time step: 20.30254435033953
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_37_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_37_1.png" />
</div>
</div>
</section>
<section id="Dense-Stepping">
<h2>Dense Stepping<a class="headerlink" href="#Dense-Stepping" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">dense_traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="c1"># years</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># make sure to increase the memory allocated for the trajectory with max_init_len</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">dense_traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">DENSE_STEPPING</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_init_len</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10520,)
</pre></div></div>
</div>
</section>
</section>
<section id="Amplitude-Module">
<h1>Amplitude Module<a class="headerlink" href="#Amplitude-Module" title="Permalink to this heading"></a></h1>
<p>The amplitude module generates the complex mode amplitudes for each harmonic mode requested, <span class="math notranslate nohighlight">\(A_{lmkn}(t)\)</span> (<span class="math notranslate nohighlight">\(k=0\)</span> for equatorial orbits). With Schwarzschild eccentric amplitudes, the user provides <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(e\)</span> as arrays and is returned the requested Teukolsky modes in a 2D array of shape (trajectory length, number of modes).</p>
<section id="ROMAN-amplitude-generation">
<h2>ROMAN amplitude generation<a class="headerlink" href="#ROMAN-amplitude-generation" title="Permalink to this heading"></a></h2>
<p>ROMAN uses a reduced order model representing the mode amplitude space. It then trains a neural network on this reduced model. The neural network is evaluated and the resulting matrix is transformed from the reduced basis back to the full mode space.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize ROMAN class</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">RomanAmplitude</span><span class="p">(</span><span class="n">max_init_len</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>  <span class="c1"># max_init_len creates memory buffers</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>

<span class="n">p_all</span><span class="p">,</span> <span class="n">e_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">temp</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total trajectory points:&#39;</span><span class="p">,</span> <span class="n">p_all</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">teuk_modes</span> <span class="o">=</span> <span class="n">amp</span><span class="p">(</span><span class="n">p_all</span><span class="p">,</span> <span class="n">e_all</span><span class="p">)</span>

<span class="c1"># look at the contours of the (2,2,0) mode</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">[:,</span> <span class="n">amp</span><span class="o">.</span><span class="n">special_index_map</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total trajectory points: 2500
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;e&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_47_2.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_47_2.png" />
</div>
</div>
<p>Specific modes can be selected by providing a list of tuple of (l,m,n) values as the <code class="docutils literal notranslate"><span class="pre">specific_modes</span></code> kwarg:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># (2, 2, 0) and (7, -3, 1) modes</span>
<span class="n">specific_modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

<span class="c1"># notice this returns a dictionary with keys as the mode tuple and values as the mode values at all trajectory points</span>
<span class="n">specific_teuk_modes</span> <span class="o">=</span> <span class="n">amp</span><span class="p">(</span><span class="n">p_all</span><span class="p">,</span> <span class="n">e_all</span><span class="p">,</span> <span class="n">specific_modes</span><span class="o">=</span><span class="n">specific_modes</span><span class="p">)</span>

<span class="c1"># we can find the index to these modes to check</span>
<span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp</span><span class="o">.</span><span class="n">special_index_map</span><span class="p">[</span><span class="n">lmn</span><span class="p">]</span> <span class="k">for</span> <span class="n">lmn</span> <span class="ow">in</span> <span class="n">specific_modes</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Indices of interest:&#39;</span><span class="p">,</span> <span class="n">inds</span><span class="p">)</span>

<span class="c1"># make sure they are the same</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">specific_teuk_modes</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">teuk_modes</span><span class="p">[:,</span> <span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

<span class="c1"># to check -m modes we need to take the conjugate</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">specific_teuk_modes</span><span class="p">[(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">[:,</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">]])))</span>

<span class="c1"># look at the contours of the (220)mode</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">specific_teuk_modes</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Indices of interest: [ 640 1922]
True
True
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;e&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_49_2.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_49_2.png" />
</div>
</div>
</section>
<section id="Interpolate-modes-with-bicubic-spline">
<h2>Interpolate modes with bicubic spline<a class="headerlink" href="#Interpolate-modes-with-bicubic-spline" title="Permalink to this heading"></a></h2>
<p>For this amplitude generator, amplitudes are interpolated in 2D (<span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(e\)</span>) using bicubic splines. They are then evaluated for the desired modes. This is used to produce our slow waveform. This will also not scale well with dimensionality. <strong>Note</strong>: Specific modes can be selected in the same way as above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize class</span>
<span class="n">amp2</span> <span class="o">=</span> <span class="n">Interp2DAmplitude</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>

<span class="n">p_all</span><span class="p">,</span> <span class="n">e_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">temp</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total trajectory points:&#39;</span><span class="p">,</span> <span class="n">p_all</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># to get all modes we can simply do this</span>
<span class="n">teuk_modes</span> <span class="o">=</span> <span class="n">amp2</span><span class="p">(</span><span class="n">p_all</span><span class="p">,</span> <span class="n">e_all</span><span class="p">)</span>

<span class="c1"># look at the contours of the (220) mode</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">[:,</span> <span class="n">amp2</span><span class="o">.</span><span class="n">special_index_map</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total trajectory points: 2500
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;e&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_53_2.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_53_2.png" />
</div>
</div>
</section>
</section>
<section id="Spin-weighted-spherical-harmonics">
<h1>Spin-weighted spherical harmonics<a class="headerlink" href="#Spin-weighted-spherical-harmonics" title="Permalink to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">few</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">()</span>  <span class="c1"># get mode information</span>

<span class="n">ylm_gen</span> <span class="o">=</span> <span class="n">GetYlms</span><span class="p">(</span><span class="n">assume_positive_m</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="c1"># viewing angles</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ylm_gen</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 2.17261840e-17+3.54815511e-01j -1.28533838e-17-2.09911687e-01j
  1.24292687e-16-1.24292687e-16j -2.46692086e-01+2.46692086e-01j]
</pre></div></div>
</div>
<p>If we assume positive m, it will return -m entries for all +m. The last 5 below are for -m. The final shape will be twice the initial length and will duplicate m=0 so be careful.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ylm_gen</span> <span class="o">=</span> <span class="n">GetYlms</span><span class="p">(</span><span class="n">assume_positive_m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># viewing angles</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>

<span class="n">ylms</span> <span class="o">=</span> <span class="n">ylm_gen</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ylm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ylms</span><span class="p">[:</span><span class="mi">5</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">ylm</span><span class="p">)</span>

<span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ylm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ylms</span><span class="p">[</span><span class="mi">5</span><span class="p">:]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1">,-</span><span class="si">{}</span><span class="s1">):&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">ylm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(2,2): (2.1726183986132194e-17+0.35481551090908514j)
(3,2): (-1.2853383784425917e-17-0.2099116870819398j)
(4,3): (1.242926870060164e-16-1.2429268700601641e-16j)
(5,3): (-0.24669208642519044+0.2466920864251905j)
(2,0): (0.2897056515173922+0j)
(2,-2): (2.4140204429035754e-18-0.039423945656564985j)
(3,-2): (-9.997076276775717e-18+0.16326464550817543j)
(4,-3): (-0.12119256904280647-0.12119256904280648j)
(5,-3): (0.2357279936951819+0.23572799369518194j)
(2,-0): (0.2897056515173922+0j)
</pre></div></div>
</div>
</section>
<section id="Mode-Selection">
<h1>Mode Selection<a class="headerlink" href="#Mode-Selection" title="Permalink to this heading"></a></h1>
<p>The mode selection module is paramount to the computational efficiency of this model. Below we show how we perform this selection operation by moving from a set of amplitudes to only those that contribute.</p>
<section id="Mode-selection-by-power-contribution">
<h2>Mode selection by power contribution<a class="headerlink" href="#Mode-selection-by-power-contribution" title="Permalink to this heading"></a></h2>
<p>Modes can also be weighted by a Power Spectral Density (PSD) function from your favorite sensitivity curve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first, lets get amplitudes for a trajectory</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span>

<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># get amplitudes along trajectory</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">RomanAmplitude</span><span class="p">()</span>

<span class="n">teuk_modes</span> <span class="o">=</span> <span class="n">amp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># get ylms</span>
<span class="n">ylms</span> <span class="o">=</span> <span class="n">ylm_gen</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">unique_l</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">unique_m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">amp</span><span class="o">.</span><span class="n">inverse_lm</span><span class="p">]</span>

<span class="c1"># select modes</span>

<span class="n">mode_selector</span> <span class="o">=</span> <span class="n">ModeSelector</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">m0mask</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span>  <span class="c1"># tolerance on mode contribution to total power</span>

<span class="n">modeinds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amp</span><span class="o">.</span><span class="n">l_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">]</span>
<span class="p">(</span><span class="n">teuk_modes_in</span><span class="p">,</span> <span class="n">ylms_in</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">=</span> <span class="n">mode_selector</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">,</span> <span class="n">ylms</span><span class="p">,</span> <span class="n">modeinds</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We reduced the mode content from </span><span class="si">{}</span><span class="s2"> modes to </span><span class="si">{}</span><span class="s2"> modes.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">teuk_modes_in</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
We reduced the mode content from 3843 modes to 874 modes.
</pre></div></div>
</div>
</section>
<section id="Mode-selection-by-noise-weighted-power-contribution">
<h2>Mode selection by noise-weighted power contribution<a class="headerlink" href="#Mode-selection-by-noise-weighted-power-contribution" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># produce sensitivity function</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;files/LPA.txt&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">PSD</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">noise</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">noise</span><span class="p">[</span><span class="s2">&quot;ASD&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">sens_fn</span> <span class="o">=</span> <span class="n">CubicSplineInterpolant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">PSD</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># select modes with noise weighting</span>

<span class="c1"># provide sensitivity function kwarg</span>
<span class="n">mode_selector_noise_weighted</span> <span class="o">=</span> <span class="n">ModeSelector</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">m0mask</span><span class="p">,</span> <span class="n">sensitivity_fn</span><span class="o">=</span><span class="n">sens_fn</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span>  <span class="c1"># tolerance on mode contribution to total power</span>

<span class="c1"># Schwarzschild</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># equatorial / cos iota</span>
<span class="n">fund_freq_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="n">modeinds</span> <span class="o">=</span> <span class="p">[</span><span class="n">amp</span><span class="o">.</span><span class="n">l_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">]</span>
<span class="p">(</span><span class="n">teuk_modes_in</span><span class="p">,</span> <span class="n">ylms_in</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">ms</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="o">=</span> <span class="n">mode_selector_noise_weighted</span><span class="p">(</span><span class="n">teuk_modes</span><span class="p">,</span> <span class="n">ylms</span><span class="p">,</span> <span class="n">modeinds</span><span class="p">,</span>
                                                                    <span class="n">fund_freq_args</span><span class="o">=</span><span class="n">fund_freq_args</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We reduced the mode content from </span><span class="si">{}</span><span class="s2"> modes to </span><span class="si">{}</span><span class="s2"> modes when using noise-weighting.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">teuk_modes_in</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
We reduced the mode content from 3843 modes to 783 modes when using noise-weighting.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/mlkatz1/miniconda3/envs/test_few/lib/python3.10/site-packages/few/summation/interpolatedmodesum.py:217: UserWarning: New t array outside bounds of input t array. These points are filled with edge values.
  warnings.warn(
</pre></div></div>
</div>
</section>
<section id="Compare-the-two-waves-with-and-without-noise-weighting">
<h2>Compare the two waves with and without noise-weighting<a class="headerlink" href="#Compare-the-two-waves-with-and-without-noise-weighting" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode_selector_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">noise_weighted_mode_selector_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sensitivity_fn</span><span class="o">=</span><span class="n">sens_fn</span><span class="p">)</span>

<span class="n">few_base</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">(</span>
    <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
    <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
    <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">few_noise_weighted</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">(</span>
    <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
    <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
    <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
    <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
    <span class="n">mode_selector_kwargs</span><span class="o">=</span><span class="n">noise_weighted_mode_selector_kwargs</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">wave_base</span> <span class="o">=</span> <span class="n">few_base</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">wave_weighted</span> <span class="o">=</span> <span class="n">few_noise_weighted</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_base</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_weighted</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave_base</span><span class="p">,</span> <span class="n">wave_weighted</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;base modes:&#39;</span><span class="p">,</span> <span class="n">few_base</span><span class="o">.</span><span class="n">num_modes_kept</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;noise-weighted modes:&#39;</span><span class="p">,</span> <span class="n">few_noise_weighted</span><span class="o">.</span><span class="n">num_modes_kept</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mismatch: 8.458387527610078e-06
base modes: 249
noise-weighted modes: 447
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_66_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_66_1.png" />
</div>
</div>
</section>
<section id="Specific-mode-selection">
<h2>Specific mode selection<a class="headerlink" href="#Specific-mode-selection" title="Permalink to this heading"></a></h2>
<p>The user can also select a specific set of modes to use in the waveform.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># l = 2, m = 2 wave</span>
<span class="n">specific_modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)]</span>

<span class="n">wave_22</span> <span class="o">=</span> <span class="n">few_base</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">mode_selection</span><span class="o">=</span><span class="n">specific_modes</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_22</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch with full wave:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave_22</span><span class="p">,</span> <span class="n">wave_base</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mismatch with full wave: 0.04836198716639917
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_69_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_69_1.png" />
</div>
</div>
</section>
<section id="Turn-off-(-m)">
<h2>Turn off (<span class="math notranslate nohighlight">\(-m\)</span>)<a class="headerlink" href="#Turn-off-(-m)" title="Permalink to this heading"></a></h2>
<p>By default, symmetry is used to generate <span class="math notranslate nohighlight">\(-m\)</span> modes. To turn this off and only use modes with (<span class="math notranslate nohighlight">\(m\)</span>), provide <code class="docutils literal notranslate"><span class="pre">False</span></code> to the <code class="docutils literal notranslate"><span class="pre">include_minus_m</span></code> kwarg. This only affects the waveform when <code class="docutils literal notranslate"><span class="pre">mode_selection</span></code> is a list of specific modes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># l = 2, m = 2 wave without m = -2</span>
<span class="n">specific_modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)]</span>

<span class="n">specific_modes_minus_m</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)]</span>

<span class="n">wave_22_pos_m</span> <span class="o">=</span> <span class="n">few_base</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>
                   <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                   <span class="n">mode_selection</span><span class="o">=</span><span class="n">specific_modes</span><span class="p">,</span> <span class="n">include_minus_m</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">wave_22_minus_m</span> <span class="o">=</span> <span class="n">few_base</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>
                   <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                   <span class="n">mode_selection</span><span class="o">=</span><span class="n">specific_modes_minus_m</span><span class="p">,</span> <span class="n">include_minus_m</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_22_pos_m</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;+m&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_22_minus_m</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch with 22 wave with + and - m:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave_22_minus_m</span><span class="p">,</span> <span class="n">wave_22_pos_m</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch with 22 original wave with adding + and - m&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave_22</span><span class="p">,</span> <span class="n">wave_22_pos_m</span> <span class="o">+</span> <span class="n">wave_22_minus_m</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mismatch with 22 wave with + and - m: 0.9986497050904085
mismatch with 22 original wave with adding + and - m 0.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_72_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_72_1.png" />
</div>
</div>
</section>
</section>
<section id="Parallelized-Cubic-Spline-Interpolation">
<h1>Parallelized Cubic Spline Interpolation<a class="headerlink" href="#Parallelized-Cubic-Spline-Interpolation" title="Permalink to this heading"></a></h1>
<p>A part of the Fast EMRI waveforms package is parallelized cubic spline interpolation. This generally means fitting and evaluating many splines in parallel with the same input x array. This is available for GPUs and CPUs (not parallelized for CPU). The user can perform this operation entirely in Python while leveraging <a class="reference external" href="https://cupy.dev/">CuPy</a> for GPUs. However, the evaluation will not be as efficient as when it is implemented properly in a customized kernel. The spline class
(<a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/index.html?highlight=modeselector#few.summation.interpolatedmodesum.CubicSplineInterpolant">CubicSplineInterpolant</a>) can provide an 1D flattened array of all spline coefficients for use in a custom CUDA kernel.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s take the amplitudes from the last step and spline those.</span>
<span class="c1"># We have to arange everything in the shape (ninterps, length)</span>
<span class="c1"># We will split real and imaginary components</span>

<span class="n">interp_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">interp_in</span><span class="p">[:</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">real</span>
<span class="n">interp_in</span><span class="p">[</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">imag</span>

<span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSplineInterpolant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">interp_in</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get new values</span>
<span class="n">t_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># notice the new shape is (ninterps, length) just like the inital input to the spline</span>
<span class="n">new_teuk_modes</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">t_new</span><span class="p">)</span>

<span class="c1"># (220) mode (real part)</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">special_index_map</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_new</span><span class="p">,</span> <span class="n">new_teuk_modes</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interpolated&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">teuk_modes</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x17b596e60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_76_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_76_1.png" />
</div>
</div>
<p>To get the array of interp coefficients for CUDA implementations, do the following. The underlying shape of the array is (4, length, ninterps). It is flattened though for entry into GPU kernel.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spline</span><span class="o">.</span><span class="n">interp_array</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 6.23856751e-06,  3.56609646e-06, -1.26237401e-06, ...,
        4.38266710e-11,  3.99290186e-11,  9.87732528e-12])
</pre></div></div>
</div>
</section>
<section id="Mode-Summation">
<h1>Mode Summation<a class="headerlink" href="#Mode-Summation" title="Permalink to this heading"></a></h1>
<p>Mode summation is the bottleneck of this calculation. We handle this in two ways: interpolation for fast waveforms and direct summation for slow waveforms. They both have the same interface and produce the same product. They take Teukolsky modes and phases and combine that information to create the waveform.</p>
<section id="Interpolated-summation">
<h2>Interpolated summation<a class="headerlink" href="#Interpolated-summation" title="Permalink to this heading"></a></h2>
<p>To maximize efficiency we use the cubic spline discussed above to accelerate the computation with interpolation and parallelized summation (on the GPU or OpenMP). This class is <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/sum.html?highlight=interpolated%20mode%20sum#few.summation.interpolatedmodesum.InterpolatedModeSum">InterpolatedModeSum</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">Tsec</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">YRSID_SI</span>

<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>
<span class="n">amp</span> <span class="o">=</span> <span class="n">RomanAmplitude</span><span class="p">()</span>
<span class="n">interpolate_mode_sum</span> <span class="o">=</span> <span class="n">InterpolatedModeSum</span><span class="p">()</span>
<span class="n">ylm_gen</span> <span class="o">=</span> <span class="n">GetYlms</span><span class="p">(</span><span class="n">assume_positive_m</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># very simplified waveform example</span>

<span class="c1"># get trajectory</span>
<span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">)</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

<span class="n">ylms</span> <span class="o">=</span> <span class="n">ylm_gen</span><span class="p">(</span><span class="n">amp</span><span class="o">.</span><span class="n">unique_l</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">unique_m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span>
    <span class="n">amp</span><span class="o">.</span><span class="n">inverse_lm</span>
<span class="p">]</span>

<span class="c1"># amplitudes</span>
<span class="n">teuk_modes</span> <span class="o">=</span> <span class="n">amp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">l_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">)</span>

<span class="c1"># need to prepare arrays for sum with all modes due to +/- m setup</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">l_arr</span><span class="p">[:</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">ms</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">[:</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">[:</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">keep_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">temp2</span> <span class="o">=</span> <span class="n">keep_modes</span> <span class="o">*</span> <span class="p">(</span><span class="n">keep_modes</span> <span class="o">&lt;</span> <span class="n">amp</span><span class="o">.</span><span class="n">num_m0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
    <span class="n">keep_modes</span> <span class="o">+</span> <span class="n">amp</span><span class="o">.</span><span class="n">num_m_1_up</span>
<span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">keep_modes</span> <span class="o">&gt;=</span> <span class="n">amp</span><span class="o">.</span><span class="n">num_m0</span><span class="p">)</span>

<span class="n">ylmkeep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">keep_modes</span><span class="p">,</span> <span class="n">temp2</span><span class="p">])</span>
<span class="n">ylms_in</span> <span class="o">=</span> <span class="n">ylms</span><span class="p">[</span><span class="n">ylmkeep</span><span class="p">]</span>
<span class="n">teuk_modes_in</span> <span class="o">=</span> <span class="n">teuk_modes</span>

<span class="c1"># summation</span>
<span class="n">waveform1</span> <span class="o">=</span> <span class="n">interpolate_mode_sum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">teuk_modes_in</span><span class="p">,</span> <span class="n">ylms_in</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">waveform1</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">waveform1</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17b7d1420&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_82_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_82_1.png" />
</div>
</div>
</section>
<section id="Direct-summation">
<h2>Direct summation<a class="headerlink" href="#Direct-summation" title="Permalink to this heading"></a></h2>
<p>For the direct mode summation, <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/sum.html?highlight=interpolated%20mode%20sum#few.summation.directmodesum.DirectModeSum">DirectModeSum</a>, we are summing up all modes at each time step directly. So, no interpolation. However, in this example, we will use interpolation up front because we need amplitude and phase arrays at all time steps for the direct mode sum because the direct mode sum will not fill in time steps like the interpolated
mode sum.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interp_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">interp_in</span><span class="p">[:</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">real</span>
<span class="n">interp_in</span><span class="p">[</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">imag</span>

<span class="n">spline</span> <span class="o">=</span> <span class="n">CubicSplineInterpolant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">interp_in</span><span class="p">)</span>

<span class="c1"># get new valu`es</span>
<span class="n">t_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt</span><span class="p">)</span>

<span class="n">interp_in2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">interp_in2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phi_phi</span>
<span class="n">interp_in2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phi_r</span>

<span class="n">spline2</span> <span class="o">=</span> <span class="n">CubicSplineInterpolant</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">interp_in2</span><span class="p">)</span>

<span class="n">Phi_phi_in</span><span class="p">,</span> <span class="n">Phi_r_in</span> <span class="o">=</span> <span class="n">spline2</span><span class="p">(</span><span class="n">t_new</span><span class="p">)</span>

<span class="c1"># notice the new shape is (ninterps, length) just like the inital input to the spline</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">t_new</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="n">teuk_modes_in</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:,</span> <span class="p">:</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">temp</span><span class="p">[:,</span> <span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span>

<span class="n">direct_mode_sum</span> <span class="o">=</span> <span class="n">DirectModeSum</span><span class="p">()</span>

<span class="n">waveform2</span> <span class="o">=</span> <span class="n">direct_mode_sum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">teuk_modes_in</span><span class="p">,</span> <span class="n">ylms_in</span><span class="p">,</span> <span class="n">Phi_phi_in</span><span class="p">,</span> <span class="n">Phi_r_in</span><span class="p">,</span> <span class="n">amp</span><span class="o">.</span><span class="n">m_arr</span><span class="p">[:</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">amp</span><span class="o">.</span><span class="n">n_arr</span><span class="p">[:</span><span class="n">teuk_modes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_new</span><span class="p">,</span> <span class="n">waveform1</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_new</span><span class="p">,</span> <span class="n">waveform2</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mismatch:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">waveform1</span><span class="p">,</span> <span class="n">waveform2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mismatch: 0.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_84_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_84_1.png" />
</div>
</div>
</section>
</section>
<section id="Utility-functions">
<h1>Utility functions<a class="headerlink" href="#Utility-functions" title="Permalink to this heading"></a></h1>
<section id="Get-options-for-installed-ODE-functions">
<h2>Get options for installed ODE functions<a class="headerlink" href="#Get-options-for-installed-ODE-functions" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">few.utils.utility</span> <span class="kn">import</span> <span class="n">get_ode_function_options</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">get_ode_function_options</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Options:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info:&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Options: [&#39;pn5&#39;, &#39;SchwarzEccFlux&#39;]
Info: {&#39;pn5&#39;: {&#39;type&#39;: &#39;func&#39;, &#39;files&#39;: [], &#39;citations&#39;: [&#39;Pn5_citation&#39;], &#39;convert_Y&#39;: True, &#39;num_add_args&#39;: 0, &#39;background&#39;: &#39;Kerr&#39;, &#39;equatorial&#39;: False, &#39;circular&#39;: False}, &#39;SchwarzEccFlux&#39;: {&#39;type&#39;: &#39;class&#39;, &#39;files&#39;: [&#39;FluxNewMinusPNScaled_fixed_y_order.dat&#39;], &#39;citations&#39;: [], &#39;num_add_args&#39;: 0, &#39;background&#39;: &#39;Schwarzschild&#39;, &#39;equatorial&#39;: True, &#39;circular&#39;: False, &#39;convert_Y&#39;: False}}
</pre></div></div>
</div>
</section>
<section id="Fundamental-Frequencies">
<h2>Fundamental Frequencies<a class="headerlink" href="#Fundamental-Frequencies" title="Permalink to this heading"></a></h2>
<p>Get dimensionless fundamental frequencies from <a class="reference external" href="https://arxiv.org/abs/gr-qc/0202090">Schmidt 2002</a>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">OmegaPhi</span><span class="p">,</span> <span class="n">OmegaTheta</span><span class="p">,</span> <span class="n">OmegaR</span> <span class="o">=</span> <span class="n">get_fundamental_frequencies</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">OmegaPhi</span><span class="p">,</span> <span class="n">OmegaTheta</span><span class="p">,</span> <span class="n">OmegaR</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p</span><span class="se">\t\t</span><span class="s1">e</span><span class="se">\t\t</span><span class="s1">x</span><span class="se">\t</span><span class="s1">OmegaPhi</span><span class="se">\t</span><span class="s1">OmegaTheta</span><span class="se">\t</span><span class="s1">OmegaR&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
p               e               x       OmegaPhi        OmegaTheta      OmegaR
[[ 8.          0.2         0.3         0.04344785  0.04162395  0.02349858]
 [ 8.22222222  0.22222222  0.31111111  0.0412017   0.03953685  0.02299122]
 [ 8.44444444  0.24444444  0.32222222  0.03905666  0.03753599  0.02241441]
 [ 8.66666667  0.26666667  0.33333333  0.03700405  0.03561442  0.02178189]
 [ 8.88888889  0.28888889  0.34444444  0.03503633  0.03376608  0.02110469]
 [ 9.11111111  0.31111111  0.35555556  0.0331469   0.03198567  0.02039181]
 [ 9.33333333  0.33333333  0.36666667  0.03133003  0.03026855  0.01965064]
 [ 9.55555556  0.35555556  0.37777778  0.02958068  0.02861065  0.01888732]
 [ 9.77777778  0.37777778  0.38888889  0.02789444  0.02700838  0.01810703]
 [10.          0.4         0.4         0.02626744  0.02545863  0.01731413]]
</pre></div></div>
</div>
</section>
<section id="Separatrix-in-Generic-Kerr">
<h2>Separatrix in Generic Kerr<a class="headerlink" href="#Separatrix-in-Generic-Kerr" title="Permalink to this heading"></a></h2>
<p>Get the separatrix in generic Kerr from <a class="reference external" href="https://arxiv.org/abs/1912.07609">Stein &amp; Warburton 2020</a>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">p_sep</span> <span class="o">=</span> <span class="n">get_separatrix</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p_sep</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e</span><span class="se">\t\t</span><span class="s1">x</span><span class="se">\t</span><span class="s1">separatrix&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
e               x       separatrix
[[0.2        0.3        5.69505166]
 [0.22222222 0.31111111 5.71503602]
 [0.24444444 0.32222222 5.73483554]
 [0.26666667 0.33333333 5.75445883]
 [0.28888889 0.34444444 5.77391509]
 [0.31111111 0.35555556 5.79321249]
 [0.33333333 0.36666667 5.81235943]
 [0.35555556 0.37777778 5.83136416]
 [0.37777778 0.38888889 5.85023483]
 [0.4        0.4        5.86897945]]
</pre></div></div>
</div>
</section>
<section id="Get-Kerr-Constants-of-Motion-(E,-L,-Q)">
<h2>Get Kerr Constants of Motion <span class="math notranslate nohighlight">\((E, L, Q)\)</span><a class="headerlink" href="#Get-Kerr-Constants-of-Motion-(E,-L,-Q)" title="Permalink to this heading"></a></h2>
<p>Get the three constants of motion <span class="math notranslate nohighlight">\((E,L,Q)\)</span> in generic Kerr spacetime.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">get_kerr_geo_constants_of_motion</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">Q</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p</span><span class="se">\t\t</span><span class="s1">e</span><span class="se">\t\t</span><span class="s1">x</span><span class="se">\t</span><span class="s1">E</span><span class="se">\t</span><span class="s1">L</span><span class="se">\t</span><span class="s1">Q&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
p               e               x       E       L       Q
[[ 8.          0.2         0.3         0.94869805  1.0488073  11.14493312]
 [ 8.22222222  0.22222222  0.31111111  0.95009671  1.09509066 11.21268793]
 [ 8.44444444  0.24444444  0.32222222  0.95151386  1.1421481  11.28086888]
 [ 8.66666667  0.26666667  0.33333333  0.95294475  1.1899692  11.34863504]
 [ 8.88888889  0.28888889  0.34444444  0.95438558  1.23854433 11.4152404 ]
 [ 9.11111111  0.31111111  0.35555556  0.95583338  1.28786454 11.48001664]
 [ 9.33333333  0.33333333  0.36666667  0.95728578  1.33792152 11.54235943]
 [ 9.55555556  0.35555556  0.37777778  0.95874089  1.38870748 11.60171749]
 [ 9.77777778  0.37777778  0.38888889  0.96019724  1.44021512 11.65758381]
 [10.          0.4         0.4         0.96165365  1.49243756 11.70948848]]
</pre></div></div>
</div>
</section>
<section id="Convert-from-x_I-to-Y">
<h2>Convert from <span class="math notranslate nohighlight">\(x_I\)</span> to <span class="math notranslate nohighlight">\(Y\)</span><a class="headerlink" href="#Convert-from-x_I-to-Y" title="Permalink to this heading"></a></h2>
<p><span class="math notranslate nohighlight">\(Y\equiv\cos{\iota}=L/\sqrt{L^2 + Q}\)</span> is different than <span class="math notranslate nohighlight">\(x_I\equiv \cos{I}\)</span>, which is accepted for relativistic waveforms and in the generic waveform interface discussed above. <span class="math notranslate nohighlight">\(I\)</span> is the inclination angle of the orbital plane to the to equatorial plane.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">xI_to_Y</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To Y:</span><span class="se">\n</span><span class="s1">p</span><span class="se">\t\t</span><span class="s1">e</span><span class="se">\t\t</span><span class="s1">x</span><span class="se">\t</span><span class="s1">Y&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="n">x_new</span> <span class="o">=</span> <span class="n">Y_to_xI</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">Y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To x:</span><span class="se">\n</span><span class="s1">p</span><span class="se">\t\t</span><span class="s1">e</span><span class="se">\t\t</span><span class="s1">x</span><span class="se">\t</span><span class="s1">Y&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
To Y:
p               e               x       Y
[[ 8.          0.2         0.3         0.29972126]
 [ 8.22222222  0.22222222  0.31111111  0.31083559]
 [ 8.44444444  0.24444444  0.32222222  0.32195073]
 [ 8.66666667  0.26666667  0.33333333  0.33306659]
 [ 8.88888889  0.28888889  0.34444444  0.3441831 ]
 [ 9.11111111  0.31111111  0.35555556  0.3553002 ]
 [ 9.33333333  0.33333333  0.36666667  0.36641781]
 [ 9.55555556  0.35555556  0.37777778  0.3775359 ]
 [ 9.77777778  0.37777778  0.38888889  0.38865439]
 [10.          0.4         0.4         0.39977325]]
To x:
p               e               x       Y
[[ 8.          0.2         0.3         0.29972126]
 [ 8.22222222  0.22222222  0.31111111  0.31083559]
 [ 8.44444444  0.24444444  0.32222222  0.32195073]
 [ 8.66666667  0.26666667  0.33333333  0.33306659]
 [ 8.88888889  0.28888889  0.34444444  0.3441831 ]
 [ 9.11111111  0.31111111  0.35555556  0.3553002 ]
 [ 9.33333333  0.33333333  0.36666667  0.36641781]
 [ 9.55555556  0.35555556  0.37777778  0.3775359 ]
 [ 9.77777778  0.37777778  0.38888889  0.38865439]
 [10.          0.4         0.4         0.39977325]]
</pre></div></div>
</div>
</section>
<section id="Get-\mu-based-on-desired-duration-of-waveform">
<h2>Get <span class="math notranslate nohighlight">\(\mu\)</span> based on desired duration of waveform<a class="headerlink" href="#Get-\mu-based-on-desired-duration-of-waveform" title="Permalink to this heading"></a></h2>
<p>If you have a desired length of waveform to analyze, this function will give you the value of <span class="math notranslate nohighlight">\(\mu\)</span> that corresponds to the proper evolution time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_module</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">11.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">traj_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">M</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">traj_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">index_of_mu</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">t_out</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="c1"># run trajectory</span>
<span class="n">mu_new</span> <span class="o">=</span> <span class="n">get_mu_at_t</span><span class="p">(</span>
    <span class="n">traj_module</span><span class="p">,</span>
    <span class="n">t_out</span><span class="p">,</span>
    <span class="n">traj_args</span><span class="p">,</span>
    <span class="n">index_of_mu</span><span class="o">=</span><span class="n">index_of_mu</span><span class="p">,</span>
    <span class="n">traj_kwargs</span><span class="o">=</span><span class="n">traj_kwargs</span><span class="p">,</span>
    <span class="n">xtol</span><span class="o">=</span><span class="mf">2e-12</span><span class="p">,</span>
    <span class="n">rtol</span><span class="o">=</span><span class="mf">8.881784197001252e-16</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mu = </span><span class="si">{}</span><span class="s1"> will create a waveform that is </span><span class="si">{}</span><span class="s1"> years long, given the other input parameters.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu_new</span><span class="p">,</span> <span class="n">t_out</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mu = 18.804088097128368 will create a waveform that is 1.5 years long, given the other input parameters.
</pre></div></div>
</div>
</section>
<section id="Get-p_0-based-on-desired-duration-of-waveform">
<h2>Get <span class="math notranslate nohighlight">\(p_0\)</span> based on desired duration of waveform<a class="headerlink" href="#Get-p_0-based-on-desired-duration-of-waveform" title="Permalink to this heading"></a></h2>
<p>If you have a desired length of waveform to analyze, this function will give you the value of <span class="math notranslate nohighlight">\(p_0\)</span> that corresponds to the proper evolution time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj_module</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">5e1</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="n">traj_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">traj_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">index_of_p</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">t_out</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="c1"># run trajectory</span>
<span class="n">p_new</span> <span class="o">=</span> <span class="n">get_p_at_t</span><span class="p">(</span>
    <span class="n">traj_module</span><span class="p">,</span>
    <span class="n">t_out</span><span class="p">,</span>
    <span class="n">traj_args</span><span class="p">,</span>
    <span class="n">index_of_p</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">index_of_a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">index_of_e</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">index_of_x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">traj_kwargs</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">xtol</span><span class="o">=</span><span class="mf">2e-12</span><span class="p">,</span>
    <span class="n">rtol</span><span class="o">=</span><span class="mf">8.881784197001252e-16</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p0 = </span><span class="si">{}</span><span class="s1"> will create a waveform that is </span><span class="si">{}</span><span class="s1"> years long, given the other input parameters.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">t_out</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
p0 = 13.059790165171117 will create a waveform that is 1.5 years long, given the other input parameters.
</pre></div></div>
</div>
</section>
<section id="Change-CUDA-device">
<h2>Change CUDA device<a class="headerlink" href="#Change-CUDA-device" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">few.utils.utility</span> <span class="kn">import</span> <span class="n">cuda_set_device</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Creating-modules">
<h1>Creating modules<a class="headerlink" href="#Creating-modules" title="Permalink to this heading"></a></h1>
<p>In addition to using our built-in modules and waveforms, you can easily create your own module or waveform. Below is an example of creating your own trajectory module and using it in a custom waveform. If you can get a reasonably fast trajectory from your specific brand of EMRI physics, you can be generating waveforms in no time! Please see the <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/">documentation</a> on this for more details on the constructions behind this.</p>
<p><strong>Important Note</strong>: If you do use this package to examine EMRI analysis problems, please contact the authors of this code (see docs) about possible collaboration and/or contribution.</p>
<section id="Post-Newtonian-trajectory">
<h2>Post-Newtonian trajectory<a class="headerlink" href="#Post-Newtonian-trajectory" title="Permalink to this heading"></a></h2>
<p>The example will be to implement a Post-Newtonian trajectory in a Schwarzschild eccentric waveform. This will be done purely in Python. However, most of our modules have backends in C/C++/CUDA for maximum efficiency. If you have a trajectory in python and want to see if it can be ported for speed, please contact the authors.</p>
<p>To get started, we will import an integrator (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.DOP853.html#scipy.integrate.DOP853">DOP853</a>) and a library for elliptical integrals that mirrors the mathematica format <code class="docutils literal notranslate"><span class="pre">mpmath</span></code>. You can run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install mpmath
</pre></div>
</div>
<p>in your conda environment to attain that library.</p>
<p>We will also import necessary things from our package. This includes constants from <code class="docutils literal notranslate"><span class="pre">few.utils.constants</span></code>, as well as two base classes to be inherited by the new module.</p>
<p>The first base class is <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/main.html#few.utils.baseclasses.SchwarzschildEccentric">SchwarzschildEccentric</a> base class that passes information specific to any Schwarzschild eccentric waveform (number of modes, (l,m,n) sets, etc.). It also has methods for general sanity checks in these limits for input parameters, trajectories, and other things. You can see the documentation for more detail on its properties.</p>
<p>The other base class is <a class="reference external" href="file:///Users/michaelkatz/Research/FastEMRIWaveforms/docs/html/user/traj.html#few.utils.baseclasses.TrajectoryBase">TrajectoryBase</a>. This houses both information for trajectory modules, as well as the interface that should be common to all trajectory modules (i.e. <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/traj.html?highlight=trajectorybase#few.utils.baseclasses.TrajectoryBase.__call__">call</a> function). It allows for flexible parameter calling
interfaces, but ensures the strict interface will be the same for all trajectory modules. Trajectory modules must implement the method <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/traj.html?highlight=trajectorybase#few.utils.baseclasses.TrajectoryBase.get_inspiral">get_inspial</a>. The common interface uses this to generate the specific trajectory.</p>
<p>This is a common theme amongst module and waveform creation. The user will take one parent abstract base class related to the waveform limits, domain of validity, and its waveform properties, and one parent abstract based class for the module type (like trajectory or summation).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we need to import an integrator and elliptic integrals</span>
<span class="kn">from</span> <span class="nn">mpmath</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">DOP853</span>

<span class="c1"># base classes</span>
<span class="kn">from</span> <span class="nn">few.utils.baseclasses</span> <span class="kn">import</span> <span class="n">TrajectoryBase</span>
<span class="kn">from</span> <span class="nn">few.utils.baseclasses</span> <span class="kn">import</span> <span class="n">SchwarzschildEccentric</span>

<span class="c1"># settings for elliptic integrals</span>
<span class="n">mp</span><span class="o">.</span><span class="n">dps</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">mp</span><span class="o">.</span><span class="n">pretty</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># constants from our package</span>
<span class="kn">from</span> <span class="nn">few.utils.constants</span> <span class="kn">import</span> <span class="n">MTSUN_SI</span><span class="p">,</span> <span class="n">YRSID_SI</span><span class="p">,</span> <span class="n">Pi</span>

<span class="c1"># for common interface with C/mathematica</span>
<span class="k">def</span> <span class="nf">Power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="n">n</span>

<span class="k">def</span> <span class="nf">Sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># this is class object just to hold epsilon as it steps</span>
<span class="c1"># this class is instantiated and then run like the derivative function in the integrator (ex. dydt)</span>
<span class="k">class</span> <span class="nc">PN</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="c1"># mass ratio</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>

        <span class="c1"># extract the four evolving parameters</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">y</span>

        <span class="c1"># guard against bad integration steps</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="mf">1e-2</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mf">6.0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span> <span class="n">e</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>


        <span class="c1"># perform elliptic calculations</span>
        <span class="n">EllipE</span> <span class="o">=</span> <span class="n">ellipe</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mf">6.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">))</span>
        <span class="n">EllipK</span> <span class="o">=</span> <span class="n">ellipk</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mf">6.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">))</span>
        <span class="n">EllipPi1</span> <span class="o">=</span> <span class="n">ellippi</span><span class="p">(</span><span class="mi">16</span><span class="o">*</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">),</span> <span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mf">6.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">))</span>
        <span class="n">EllipPi2</span> <span class="o">=</span> <span class="n">ellippi</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mf">6.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">)),</span> <span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mf">6.0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">))</span>

        <span class="c1"># Azimuthal frequency</span>
        <span class="n">Omega_phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">Sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">EllipPi2</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">EllipE</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span>
              <span class="p">(</span><span class="n">EllipK</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">28</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">12</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">EllipK</span> <span class="o">+</span> <span class="n">EllipPi2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">EllipK</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">EllipPi1</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="n">p</span><span class="p">)))</span><span class="o">/</span>
            <span class="p">(</span><span class="n">EllipK</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))))</span>

        <span class="c1"># Post-Newtonian calculations</span>
        <span class="n">yPN</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Omega_phi</span><span class="p">,</span><span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>

        <span class="n">EdotPN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">96</span> <span class="o">+</span> <span class="mi">292</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">37</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">15.</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mf">3.5</span><span class="p">))</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">yPN</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">LdotPN</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="mf">5.</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">yPN</span><span class="p">,</span> <span class="mf">7.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

        <span class="c1"># flux</span>
        <span class="n">Edot</span> <span class="o">=</span> <span class="o">-</span><span class="n">epsilon</span><span class="o">*</span><span class="p">(</span><span class="n">EdotPN</span><span class="p">)</span>
        <span class="n">Ldot</span> <span class="o">=</span> <span class="o">-</span><span class="n">epsilon</span><span class="o">*</span><span class="p">(</span><span class="n">LdotPN</span><span class="p">)</span>

        <span class="c1"># time derivatives</span>
        <span class="n">pdot</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Edot</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ldot</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">edot</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">Edot</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span><span class="o">*</span>
        <span class="p">(</span><span class="mi">18</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Ldot</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span>
        <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>

        <span class="n">Phi_phi_dot</span> <span class="o">=</span> <span class="n">Omega_phi</span><span class="p">;</span>

        <span class="n">Phi_r_dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">Sqrt</span><span class="p">((</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="n">Pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">EllipK</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">EllipPi2</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">EllipE</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span>
        <span class="p">(</span><span class="n">EllipK</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">28</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">12</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Power</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">EllipK</span> <span class="o">+</span> <span class="n">EllipPi2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">)))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">EllipK</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">EllipPi1</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e</span> <span class="o">-</span> <span class="n">p</span><span class="p">)))</span><span class="o">/</span><span class="n">Power</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">dydt</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdot</span><span class="p">,</span> <span class="n">edot</span><span class="p">,</span> <span class="n">Phi_phi_dot</span><span class="p">,</span> <span class="n">Phi_r_dot</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">dydt</span>


<span class="c1"># this is the actual class that implements a PN trajectory. It uses the PN class in the integrator.</span>
<span class="k">class</span> <span class="nc">PnTrajectory</span><span class="p">(</span><span class="n">TrajectoryBase</span><span class="p">):</span>

    <span class="c1"># for common interface with *args and **kwargs</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># required by the trajectory base class</span>
    <span class="k">def</span> <span class="nf">get_inspiral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># set up quantities and integrator</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="n">T</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="n">YRSID_SI</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MTSUN_SI</span><span class="p">)</span>

        <span class="n">Msec</span> <span class="o">=</span> <span class="n">M</span> <span class="o">*</span> <span class="n">MTSUN_SI</span>

        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="n">M</span>
        <span class="n">integrator</span> <span class="o">=</span> <span class="n">DOP853</span><span class="p">(</span><span class="n">PN</span><span class="p">(</span><span class="n">epsilon</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="n">t_out</span><span class="p">,</span> <span class="n">p_out</span><span class="p">,</span> <span class="n">e_out</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">Phi_phi_out</span><span class="p">,</span> <span class="n">Phi_r_out</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">t_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">p_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">e_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e0</span><span class="p">)</span>
        <span class="n">Phi_phi_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">Phi_r_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># run the integrator down to T or separatrix</span>
        <span class="n">run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">integrator</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">T</span> <span class="ow">and</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">integrator</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">integrator</span><span class="o">.</span><span class="n">y</span>
            <span class="n">t_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integrator</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="n">Msec</span><span class="p">)</span>
            <span class="n">p_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">e_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">Phi_phi_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Phi_phi</span><span class="p">)</span>
            <span class="n">Phi_r_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Phi_r</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">run</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># read out data. It must return length 6 tuple</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t_out</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p_out</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">e_out</span><span class="p">)</span>
        <span class="n">Phi_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Phi_phi_out</span><span class="p">)</span>
        <span class="n">Phi_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Phi_r_out</span><span class="p">)</span>

        <span class="c1"># need to add polar info</span>
        <span class="n">Phi_theta</span> <span class="o">=</span> <span class="n">Phi_phi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># by construction</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">Phi_theta</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Test-your-trajectory">
<h2>Test your trajectory<a class="headerlink" href="#Test-your-trajectory" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">traj</span> <span class="o">=</span> <span class="n">PnTrajectory</span><span class="p">()</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="n">traj2</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;SchwarzEccFlux&quot;</span><span class="p">)</span>

<span class="n">flux</span> <span class="o">=</span> <span class="n">traj2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;trajectory_pn_vs_flux.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_114_0.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_114_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;p&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_115_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_115_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flux</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;e&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_116_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_116_1.png" />
</div>
</div>
</section>
<section id="Implement-ODE-in-C/C++">
<h2>Implement ODE in C/C++<a class="headerlink" href="#Implement-ODE-in-C/C++" title="Permalink to this heading"></a></h2>
<p>If you want to implement a set of ODE equations in C/C++, you can add your function to <code class="docutils literal notranslate"><span class="pre">src/ode_base.cc</span></code>. You have to create the file if you have not already. Make sure it is in the <code class="docutils literal notranslate"><span class="pre">src/</span></code> directory. When you run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup</span> <span class="pre">install</span></code>, the installer will build a full file of ODEs and take care of all of the backend aspects to the integration. <strong>You only have to implement the ODE</strong>. You identify the ODE functions with <code class="docutils literal notranslate"><span class="pre">__deriv__</span></code> decorator. <code class="docutils literal notranslate"><span class="pre">#define</span></code> is then used to give extra
necessary information on the function. Options are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_num_add_args</span> <span class="pre">{number</span> <span class="pre">of</span> <span class="pre">added</span> <span class="pre">args}</span></code>: Number of additional arguments beyond the required arguments.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_spinless</span></code>: Indicated Schwarzschild background.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_circular</span></code>: No eccentricity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_equatorial</span></code>: Constrained to equatorial plane.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_Y</span></code>: Indicates the function is integrated in <span class="math notranslate nohighlight">\(Y\)</span> rather than <span class="math notranslate nohighlight">\(x_I\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_file{file</span> <span class="pre">number}</span> <span class="pre">{file</span> <span class="pre">name}</span></code>: File names required for proper use of function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">{waveform</span> <span class="pre">function</span> <span class="pre">name}_citation{citation</span> <span class="pre">number}</span> <span class="pre">{citation</span> <span class="pre">name}</span></code>: Citations for the function. <code class="docutils literal notranslate"><span class="pre">citation</span> <span class="pre">name</span></code> should be the name of the variable the citation is assigned to in <code class="docutils literal notranslate"><span class="pre">few.utils.citations</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">__deriv__</span></code> function must be of the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void {functionname}(double* pdot, double* edot, double* Ydot,
                  double* Omega_phi, double* Omega_theta, double* Omega_r,
                  double epsilon, double a, double p, double e, double Y, double* additional_args)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">double*</span></code> args, except <code class="docutils literal notranslate"><span class="pre">additional_args</span></code>, represent pointers to doubles representing the output derivative values. <code class="docutils literal notranslate"><span class="pre">double</span></code> args are input values. <code class="docutils literal notranslate"><span class="pre">additional_args</span></code> is a pointer to a double array that holds any extra arguments to be included.</p>
<section id="Analytic-functions-that-do-not-need-storage">
<h3>Analytic functions that do not need storage<a class="headerlink" href="#Analytic-functions-that-do-not-need-storage" title="Permalink to this heading"></a></h3>
<p>If the ODE is purely analytic, a function will work. Here is an example with the 5PN trajectory (see<code class="docutils literal notranslate"><span class="pre">include/ode_base_example.cc</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define pn5_Y
#define pn5_citation1 pn5_citation
__deriv__
void pn5(double* pdot, double* edot, double* Ydot,
                  double* Omega_phi, double* Omega_theta, double* Omega_r,
                  double epsilon, double a, double p, double e, double Y, double* additional_args)
{
    // evaluate ODEs

    // the frequency variables are pointers!
    double x = Y_to_xI(a, p, e, Y);
    KerrGeoCoordinateFrequencies(Omega_phi, Omega_theta, Omega_r, a, p, e, x);

    int Nv = 10;
    int ne = 10;
    *pdot = epsilon * dpdt8H_5PNe10 (a, p, e, Y, Nv, ne);

    // needs adjustment for validity
    Nv = 10;
    ne = 8;
    *edot = epsilon * dedt8H_5PNe10 (a, p, e, Y, Nv, ne);

    Nv = 7;
    ne = 10;
    *Ydot = epsilon * dYdt8H_5PNe10 (a, p, e, Y, Nv, ne);

}
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">pn5_y</span></code> indicates the function integrates in <span class="math notranslate nohighlight">\(Y\)</span> rather than <span class="math notranslate nohighlight">\(x_I\)</span>.</p>
</section>
<section id="Functions-that-require-storage">
<h3>Functions that require storage<a class="headerlink" href="#Functions-that-require-storage" title="Permalink to this heading"></a></h3>
<p>If your function requires the storage of files or interpolants, you can also build your ODE as a class. In this case, it must have a constructor, destructor, and method called <code class="docutils literal notranslate"><span class="pre">deriv_func</span></code> with the ODEs.</p>
<p>Here is the implementation for the flux driven trajectory (see<code class="docutils literal notranslate"><span class="pre">include/ode_base_example.cc</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// Class to carry gsl interpolants for the inspiral data
// also executes inspiral calculations
SchwarzEccFlux::SchwarzEccFlux(std::string few_dir)
{
    interps = new interp_params;

    // prepare the data
    // python will download the data if
    // the user does not have it in the correct place
    load_and_interpolate_flux_data(interps, few_dir);
    //load_and_interpolate_amp_vec_norm_data(&amp;amp_vec_norm_interp, few_dir);
}

#define SchwarzEccFlux_num_add_args 0
#define SchwarzEccFlux_spinless
#define SchwarzEccFlux_equatorial
#define SchwarzEccFlux_file1 FluxNewMinusPNScaled_fixed_y_order.dat
__deriv__
void SchwarzEccFlux::deriv_func(double* pdot, double* edot, double* xdot,
                  double* Omega_phi, double* Omega_theta, double* Omega_r,
                  double epsilon, double a, double p, double e, double x, double* additional_args)
{
    if ((6.0 + 2. * e) &gt; p)
    {
        *pdot = 0.0;
        *edot = 0.0;
        *xdot = 0.0;
        return;
    }

    SchwarzschildGeoCoordinateFrequencies(Omega_phi, Omega_r, p, e);
    *Omega_theta = *Omega_phi;

    double y1 = log((p -2.*e - 2.1));

    // evaluate ODEs, starting with PN contribution, then interpolating over remaining flux contribution

    double yPN = pow((*Omega_phi),2./3.);

    double EdotPN = (96 + 292*Power(e,2) + 37*Power(e,4))/(15.*Power(1 - Power(e,2),3.5)) * pow(yPN, 5);
    double LdotPN = (4*(8 + 7*Power(e,2)))/(5.*Power(-1 + Power(e,2),2)) * pow(yPN, 7./2.);

    double Edot = -epsilon*(interps-&gt;Edot-&gt;eval(y1, e)*pow(yPN,6.) + EdotPN);

    double Ldot = -epsilon*(interps-&gt;Ldot-&gt;eval(y1, e)*pow(yPN,9./2.) + LdotPN);

    *pdot = (-2*(Edot*Sqrt((4*Power(e,2) - Power(-2 + p,2))/(3 + Power(e,2) - p))*(3 + Power(e,2) - p)*Power(p,1.5) + Ldot*Power(-4 + p,2)*Sqrt(-3 - Power(e,2) + p)))/(4*Power(e,2) - Power(-6 + p,2));

    // handle e = 0.0
    if (e &gt; 0.)
    {
        *edot = -((Edot*Sqrt((4*Power(e,2) - Power(-2 + p,2))/(3 + Power(e,2) - p))*Power(p,1.5)*
                  (18 + 2*Power(e,4) - 3*Power(e,2)*(-4 + p) - 9*p + Power(p,2)) +
                 (-1 + Power(e,2))*Ldot*Sqrt(-3 - Power(e,2) + p)*(12 + 4*Power(e,2) - 8*p + Power(p,2)))/
                (e*(4*Power(e,2) - Power(-6 + p,2))*p));
    }
    else
    {
        *edot = 0.0;
    }

    *xdot = 0.0;
}

// When interfacing with cython, it helps to have  dealloc function to explicitly call
// rather than the deconstructor
SchwarzEccFlux::~SchwarzEccFlux()
{

    delete interps-&gt;Edot;
    delete interps-&gt;Ldot;
    delete interps;


}
</pre></div>
</div>
<p>In this case, where the functions are implemented in a class, you will have to add the class to the header file: <code class="docutils literal notranslate"><span class="pre">include/ode_base.hh</span></code>. You do not need to add anything to the header file if you are working with functions and not classes. You will need to create this file if you have not already. Make sure it is in the <code class="docutils literal notranslate"><span class="pre">include/</span></code> directory. Here is an example of what is placed in the header file when working with classes (see <code class="docutils literal notranslate"><span class="pre">include/ode_base_example.hh</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#include &quot;Interpolant.h&quot;

// Used to pass the interpolants to the ODE solver
struct interp_params{
    double epsilon;
    Interpolant *Edot;
    Interpolant *Ldot;
};

class SchwarzEccFlux{
public:
    interp_params *interps;
    Interpolant *amp_vec_norm_interp;
    double test;

    SchwarzEccFlux(std::string few_dir);

    void deriv_func(double* pdot, double* edot, double* Ydot,
                      double* Omega_phi, double* Omega_theta, double* Omega_r,
                      double epsilon, double a, double p, double e, double Y, double* additional_args);
    ~SchwarzEccFlux();
};
</pre></div>
</div>
</section>
</section>
<section id="Make-a-waveform-model">
<h2>Make a waveform model<a class="headerlink" href="#Make-a-waveform-model" title="Permalink to this heading"></a></h2>
<p>Now we will create a waveform with our new trajectory model. To do this, we will start with <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/main.html#few.waveform.SchwarzschildEccentricWaveformBase">SchwarzschildEccentricWaveformBase</a>. This base class has already inherited from <a class="reference external" href="https://mikekatz04.github.io/FastEMRIWaveforms/html/user/main.html#few.utils.baseclasses.SchwarzschildEccentric">SchwarzschildEccentric</a>. It creates the common interface for all waveform modules (and how
they interface with there constituent modules). A requirement when creating a module is to have properties describing the GPU capability of the waveform, as well as whether or not it allows for batching the waveform creation (after trajectory).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FastSchwarzschildEccentricPn</span><span class="p">(</span><span class="n">SchwarzschildEccentricWaveformBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">sum_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>

        <span class="n">SchwarzschildEccentricWaveformBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">PnTrajectory</span><span class="p">,</span>
            <span class="n">RomanAmplitude</span><span class="p">,</span>
            <span class="n">InterpolatedModeSum</span><span class="p">,</span>
            <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
            <span class="n">amplitude_kwargs</span><span class="o">=</span><span class="n">amplitude_kwargs</span><span class="p">,</span>
            <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
            <span class="n">Ylm_kwargs</span><span class="o">=</span><span class="n">Ylm_kwargs</span><span class="p">,</span>
            <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gpu_capability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allow_batching</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</section>
<section id="Test-your-waveform">
<h2>Test your waveform<a class="headerlink" href="#Test-your-waveform" title="Permalink to this heading"></a></h2>
<p>It will have the same interface as the other waveforms.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricPn</span><span class="p">()</span>

<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">T</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>

<span class="n">wave1</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="n">wave2</span> <span class="o">=</span> <span class="n">few</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># end of waveform is where we can see the difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave1</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="o">-</span><span class="mi">6000</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pn&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave2</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="o">-</span><span class="mi">6000</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mismatch:&#39;</span><span class="p">,</span> <span class="n">get_mismatch</span><span class="p">(</span><span class="n">wave1</span><span class="p">,</span> <span class="n">wave2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;pn_vs_flux.pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mismatch: 0.932708770517177
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_129_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_129_1.png" />
</div>
</div>
</section>
</section>
<section id="Augmented-Analytic-Kludge-with-5PN-trajectory">
<h1>Augmented Analytic Kludge with 5PN trajectory<a class="headerlink" href="#Augmented-Analytic-Kludge-with-5PN-trajectory" title="Permalink to this heading"></a></h1>
<p>We have now implemented a new version of the Augmented Analytic Kludge with 5PN trajectories.</p>
<p>Waveforms are generated based on the Augmented Analytic Kludge given in the <a class="reference external" href="https://github.com/alvincjk/EMRI_Kludge_Suite/">EMRI Kludge Suite</a>. However, here the trajectory is vastly improved by employing the 5PN fluxes for generic Kerr orbits from <a class="reference external" href="https://arxiv.org/abs/2008.13554">Fujita &amp; Shibata (2020)</a>.</p>
<p>The 5PN trajectory produces orbital and phase trajectories. The trajectory is calculated until the orbit reaches within 0.2 of the separatrix, determined from <a class="reference external" href="https://arxiv.org/abs/1912.07609/">Stein and Warburton (2020)</a>. The fundamental frequencies along the trajectory at each point are then calculated from the orbital parameters and the spin value given by <a class="reference external" href="https://arxiv.org/abs/gr-qc/0202090%3E">Schmidt (2002)</a>.</p>
<p>These frequencies along the trajectory are then used to map to the frequency basis of the <a class="reference external" href="https://arxiv.org/abs/gr-qc/0310125">Analytic Kludge</a>. This mapping takes the form of time evolving large mass and spin parameters, as well as the use of phases and frequencies in <span class="math notranslate nohighlight">\(\alpha, \Phi, \gamma\)</span>:</p>
<p><span class="math">\begin{align}
\Phi &= \Phi_\phi, \\
\gamma &= \Phi_\phi + \Phi_\theta, \\
\alpha &= \Phi_\phi + \Phi_\theta + \Phi_r. \\
\end{align}</span></p>
<p>The frequencies in that basis are found by taking the time derivatives of each equation above.</p>
<p><strong>Please note:</strong> the 5PN trajectory and AAK waveform take the parameter <span class="math notranslate nohighlight">\(Y\equiv\cos{\iota}=L/\sqrt{L^2 + Q}\)</span> rather than <span class="math notranslate nohighlight">\(x_I\)</span> as is accepted for relativistic waveforms and in the generic waveform interface discussed above. The generic waveform interface directly converts <span class="math notranslate nohighlight">\(x_I\)</span> to <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>This class has GPU capabilities and works from the sparse trajectory methodoligy with cubic spine interpolation of the smoothly varying waveform quantities. This waveform does not have the freedom in terms of user-chosen quantitites that <code class="docutils literal notranslate"><span class="pre">few.waveform.SchwarzschildEccentricWaveformBase</span></code> contains. This is mainly due to the specific waveform constructions particular to the AAK/AK.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># keyword arguments for inspiral generator (RunKerrGenericPn5Inspiral)</span>
<span class="n">inspiral_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;DENSE_STEPPING&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># we want a sparsely sampled trajectory</span>
    <span class="s2">&quot;max_init_len&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="p">),</span>  <span class="c1"># all of the trajectories will be well under len = 1000</span>
<span class="p">}</span>

<span class="c1"># keyword arguments for summation generator (AAKSummation)</span>
<span class="n">sum_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="n">use_gpu</span><span class="p">,</span>  <span class="c1"># GPU is availabel for this type of summation</span>
    <span class="s2">&quot;pad_output&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">wave_generator</span> <span class="o">=</span> <span class="n">Pn5AAKWaveform</span><span class="p">(</span><span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span> <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">0.8</span>


<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mich</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">waveform</span> <span class="o">=</span> <span class="n">wave_generator</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span>
                          <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">mich</span><span class="o">=</span><span class="n">mich</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveform</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17cb2f730&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_133_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_133_1.png" />
</div>
</div>
<p>We can also assume a long-wavelength LISA response by setting <code class="docutils literal notranslate"><span class="pre">mich=True</span></code>. Please note this is not Time-delay interferometry (TDI).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waveform_lw</span> <span class="o">=</span> <span class="n">wave_generator</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">mich</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">waveform_lw</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_lw</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">waveform_lw</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17cb68d60&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_136_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_136_1.png" />
</div>
</div>
<section id="5PN-Trajectory">
<h2>5PN Trajectory<a class="headerlink" href="#5PN-Trajectory" title="Permalink to this heading"></a></h2>
<p>This new waveform includes 5PN trajectories from <a class="reference external" href="https://arxiv.org/abs/2008.13554">Fujita &amp; Shibata 2020</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;pn5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>


<span class="c1"># run trajectory</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span>
                                             <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
138 4.530567369168844
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$Y$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\theta$&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_141_0.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_141_0.png" />
</div>
</div>
<p>With the PN trajectory, we need to be careful at smaller <span class="math notranslate nohighlight">\(p\)</span>, larger <span class="math notranslate nohighlight">\(a\)</span>, and larger <span class="math notranslate nohighlight">\(e\)</span>. This trajectory can exihibt pathological behavior near these extremes. Therefore, we provide the option to truncate the trajectory at the Schwarzschild (<span class="math notranslate nohighlight">\(a=0\)</span>) separatrix, <span class="math notranslate nohighlight">\(6 + 2e\)</span>. To do this, you provide the keyword <code class="docutils literal notranslate"><span class="pre">enforce_schwarz_sep=True</span></code> to the initialization of the class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize trajectory class</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">EMRIInspiral</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="s2">&quot;pn5&quot;</span><span class="p">,</span> <span class="n">enforce_schwarz_sep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>


<span class="c1"># run trajectory</span>
<span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span> <span class="o">=</span> <span class="n">traj</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span>
                                             <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
102 6.549940753074665
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$Y$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\phi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_r$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Phi_\theta$&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Phi_phi</span><span class="p">,</span> <span class="n">Phi_r</span><span class="p">,</span> <span class="n">Phi_theta</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_145_0.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_145_0.png" />
</div>
</div>
</section>
<section id="Building-an-AAK-waveform-from-a-given-trajectory-(in-this-case-the-5PN-trajectory)">
<h2>Building an AAK waveform from a given trajectory (in this case the 5PN trajectory)<a class="headerlink" href="#Building-an-AAK-waveform-from-a-given-trajectory-(in-this-case-the-5PN-trajectory)" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">few.utils.baseclasses</span> <span class="kn">import</span> <span class="n">Pn5AAK</span><span class="p">,</span> <span class="n">ParallelModuleBase</span>

<span class="k">class</span> <span class="nc">NewPn5AAKWaveform</span><span class="p">(</span><span class="n">AAKWaveformBase</span><span class="p">,</span> <span class="n">Pn5AAK</span><span class="p">,</span> <span class="n">ParallelModuleBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">sum_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>

        <span class="n">inspiral_kwargs</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pn5&quot;</span>

        <span class="n">AAKWaveformBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">EMRIInspiral</span><span class="p">,</span>  <span class="c1"># trajectory class</span>
            <span class="n">AAKSummation</span><span class="p">,</span>
            <span class="n">inspiral_kwargs</span><span class="o">=</span><span class="n">inspiral_kwargs</span><span class="p">,</span>
            <span class="n">sum_kwargs</span><span class="o">=</span><span class="n">sum_kwargs</span><span class="p">,</span>
            <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set initial parameters</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">14.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">iota0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">iota0</span><span class="p">)</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">0.8</span>


<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mich</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">wave_generator</span> <span class="o">=</span> <span class="n">NewPn5AAKWaveform</span><span class="p">()</span>
<span class="n">AAK_out</span> <span class="o">=</span> <span class="n">wave_generator</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">qS</span><span class="p">,</span> <span class="n">phiS</span><span class="p">,</span> <span class="n">qK</span><span class="p">,</span> <span class="n">phiK</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span>
                          <span class="n">Phi_phi0</span><span class="o">=</span><span class="n">Phi_phi0</span><span class="p">,</span> <span class="n">Phi_theta0</span><span class="o">=</span><span class="n">Phi_theta0</span><span class="p">,</span> <span class="n">Phi_r0</span><span class="o">=</span><span class="n">Phi_r0</span><span class="p">,</span> <span class="n">mich</span><span class="o">=</span><span class="n">mich</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAK_out</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAK_out</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x179e4a6b0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_149_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_149_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAK_out</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">AAK_out</span><span class="o">.</span><span class="n">imag</span><span class="p">[:</span><span class="mi">400</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x178e106d0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_150_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_150_1.png" />
</div>
</div>
</section>
<section id="Generating-the-new-AAK-with-the-generic-waveform-generator">
<h2>Generating the new AAK with the generic waveform generator<a class="headerlink" href="#Generating-the-new-AAK-with-the-generic-waveform-generator" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gen_wave</span> <span class="o">=</span> <span class="n">GenerateEMRIWaveform</span><span class="p">(</span><span class="s2">&quot;Pn5AAKWaveform&quot;</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># seconds</span>
<span class="n">M</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1e1</span>
<span class="n">p0</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="n">e0</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># notice this is x_I, not Y. The AAK waveform can convert to Y.</span>
<span class="n">qK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># polar spin angle</span>
<span class="n">phiK</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">qS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># polar sky angle</span>
<span class="n">phiS</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># azimuthal viewing angle</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># distance</span>
<span class="n">Phi_phi0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Phi_theta0</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">Phi_r0</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">gen_wave</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">p0</span><span class="p">,</span>
    <span class="n">e0</span><span class="p">,</span>
    <span class="n">x0</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">qS</span><span class="p">,</span>
    <span class="n">phiS</span><span class="p">,</span>
    <span class="n">qK</span><span class="p">,</span>
    <span class="n">phiK</span><span class="p">,</span>
    <span class="n">Phi_phi0</span><span class="p">,</span>
    <span class="n">Phi_theta0</span><span class="p">,</span>
    <span class="n">Phi_r0</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">2000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17ceab9d0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_FastEMRIWaveforms_tutorial_152_1.png" src="../_images/tutorial_FastEMRIWaveforms_tutorial_152_1.png" />
</div>
</div>
</section>
</section>
<section id="Citing-waveforms-and-modules">
<h1>Citing waveforms and modules<a class="headerlink" href="#Citing-waveforms-and-modules" title="Permalink to this heading"></a></h1>
<p>If you use any work from this package please cite our papers <a class="reference external" href="https://arxiv.org/abs/2104.04582">arxiv.org/2104.04582</a> and <a class="reference external" href="https://arxiv.org/abs/2008.06071">arxiv.org/2008.06071</a>. Additionally please cite any additional work for each module used by calling the <code class="docutils literal notranslate"><span class="pre">citation</span></code> attribute on the module class:</p>
<section id="Fast-Schwarzschild-Eccentric-Waveforms">
<h2>Fast Schwarzschild Eccentric Waveforms<a class="headerlink" href="#Fast-Schwarzschild-Eccentric-Waveforms" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">FastSchwarzschildEccentricFlux</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wave</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

@article{Katz:2021yft,
    author = &#34;Katz, Michael L. and Chua, Alvin J. K. and Speri, Lorenzo and Warburton, Niels and Hughes, Scott A.&#34;,
    title = &#34;{FastEMRIWaveforms: New tools for millihertz gravitational-wave data analysis}&#34;,
    eprint = &#34;2104.04582&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    month = &#34;4&#34;,
    year = &#34;2021&#34;
}

@article{Chua:2020stf,
    author = &#34;Chua, Alvin J. K. and Katz, Michael L. and Warburton, Niels and Hughes, Scott A.&#34;,
    title = &#34;{Rapid generation of fully relativistic extreme-mass-ratio-inspiral waveform templates for LISA data analysis}&#34;,
    eprint = &#34;2008.06071&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevLett.126.051102&#34;,
    journal = &#34;Phys. Rev. Lett.&#34;,
    volume = &#34;126&#34;,
    number = &#34;5&#34;,
    pages = &#34;051102&#34;,
    year = &#34;2021&#34;
}

@software{michael_l_katz_2020_4005001,
  author       = {Michael L. Katz and
                  Alvin J. K. Chua and
                  Niels Warburton and
                  Scott A. Hughes.},
  title        = {{BlackHolePerturbationToolkit/FastEMRIWaveforms:
                   Official Release}},
  month        = aug,
  year         = 2020,
  publisher    = {Zenodo},
  version      = {v1.0.0},
  doi          = {10.5281/zenodo.4005001},
  url          = {https://doi.org/10.5281/zenodo.4005001}
}

@article{Chua:2018woh,
    author = &#34;Chua, Alvin J.K. and Galley, Chad R. and Vallisneri, Michele&#34;,
    title = &#34;{Reduced-order modeling with artificial neurons for gravitational-wave inference}&#34;,
    eprint = &#34;1811.05491&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;astro-ph.IM&#34;,
    doi = &#34;10.1103/PhysRevLett.122.211101&#34;,
    journal = &#34;Phys. Rev. Lett.&#34;,
    volume = &#34;122&#34;,
    number = &#34;21&#34;,
    pages = &#34;211101&#34;,
    year = &#34;2019&#34;
}

</pre></div></div>
</div>
</section>
<section id="New-and-Improved-AAK-with-5PN-Trajectory">
<h2>New and Improved AAK with 5PN Trajectory<a class="headerlink" href="#New-and-Improved-AAK-with-5PN-Trajectory" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave_aak</span> <span class="o">=</span> <span class="n">Pn5AAKWaveform</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wave_aak</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

@article{Katz:2021yft,
    author = &#34;Katz, Michael L. and Chua, Alvin J. K. and Speri, Lorenzo and Warburton, Niels and Hughes, Scott A.&#34;,
    title = &#34;{FastEMRIWaveforms: New tools for millihertz gravitational-wave data analysis}&#34;,
    eprint = &#34;2104.04582&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    month = &#34;4&#34;,
    year = &#34;2021&#34;
}

@article{Chua:2020stf,
    author = &#34;Chua, Alvin J. K. and Katz, Michael L. and Warburton, Niels and Hughes, Scott A.&#34;,
    title = &#34;{Rapid generation of fully relativistic extreme-mass-ratio-inspiral waveform templates for LISA data analysis}&#34;,
    eprint = &#34;2008.06071&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevLett.126.051102&#34;,
    journal = &#34;Phys. Rev. Lett.&#34;,
    volume = &#34;126&#34;,
    number = &#34;5&#34;,
    pages = &#34;051102&#34;,
    year = &#34;2021&#34;
}

@software{michael_l_katz_2020_4005001,
  author       = {Michael L. Katz and
                  Alvin J. K. Chua and
                  Niels Warburton and
                  Scott A. Hughes.},
  title        = {{BlackHolePerturbationToolkit/FastEMRIWaveforms:
                   Official Release}},
  month        = aug,
  year         = 2020,
  publisher    = {Zenodo},
  version      = {v1.0.0},
  doi          = {10.5281/zenodo.4005001},
  url          = {https://doi.org/10.5281/zenodo.4005001}
}


@article{Chua:2015mua,
    author = &#34;Chua, Alvin J.K. and Gair, Jonathan R.&#34;,
    title = &#34;{Improved analytic extreme-mass-ratio inspiral model for scoping out eLISA data analysis}&#34;,
    eprint = &#34;1510.06245&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1088/0264-9381/32/23/232002&#34;,
    journal = &#34;Class. Quant. Grav.&#34;,
    volume = &#34;32&#34;,
    pages = &#34;232002&#34;,
    year = &#34;2015&#34;
}


@article{Chua:2017ujo,
    author = &#34;Chua, Alvin J.K. and Moore, Christopher J. and Gair, Jonathan R.&#34;,
    title = &#34;{Augmented kludge waveforms for detecting extreme-mass-ratio inspirals}&#34;,
    eprint = &#34;1705.04259&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevD.96.044005&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;96&#34;,
    number = &#34;4&#34;,
    pages = &#34;044005&#34;,
    year = &#34;2017&#34;
}

@article{Barack:2003fp,
    author = &#34;Barack, Leor and Cutler, Curt&#34;,
    title = &#34;{LISA capture sources: Approximate waveforms, signal-to-noise ratios, and parameter estimation accuracy}&#34;,
    eprint = &#34;gr-qc/0310125&#34;,
    archivePrefix = &#34;arXiv&#34;,
    doi = &#34;10.1103/PhysRevD.69.082005&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;69&#34;,
    pages = &#34;082005&#34;,
    year = &#34;2004&#34;
}

@article{Fujita:2020zxe,
    author = &#34;Fujita, Ryuichi and Shibata, Masaru&#34;,
    title = &#34;{Extreme mass ratio inspirals on the equatorial plane in the adiabatic order}&#34;,
    eprint = &#34;2008.13554&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevD.102.064005&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;102&#34;,
    number = &#34;6&#34;,
    pages = &#34;064005&#34;,
    year = &#34;2020&#34;
}

@article{Stein:2019buj,
    author = &#34;Stein, Leo C. and Warburton, Niels&#34;,
    title = &#34;{Location of the last stable orbit in Kerr spacetime}&#34;,
    eprint = &#34;1912.07609&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevD.101.064007&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;101&#34;,
    number = &#34;6&#34;,
    pages = &#34;064007&#34;,
    year = &#34;2020&#34;
}

</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../user/cite.html" class="btn btn-neutral float-left" title="Citations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tutorial_FD_construction_single_mode.html" class="btn btn-neutral float-right" title="Single Mode Frequency Domain Waveform Construction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Michael Katz, Alvin Chua, Niels Warburton.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>