import os
import time

try:
    import cupy as xp
    from FEW import cublas_test_layer
except ImportError:
    import numpy as xp

import numpy as np


class LeakyReLU:
    def __init__(self, alpha=0.2):
        self.alpha = 0.2

    def __call__(self, x):
        return x * (x >= 0.0) + 0.2 * x * (x < 0.0)


class Linear:
    def __init__(self, w, b):
        self.w = w
        self.b = b

    def __call__(self, x):

        out = xp.zeros((x.shape[0], self.w.shape[1]), dtype=xp.float64).T.flatten()

        """
        if self.w.shape[1] == 128:
            x_c = x.copy().T.flatten()
            w_c = self.w.copy().T.flatten()
            b_c = self.b.copy().T.flatten()

            cublas_test_layer(
                out,
                x_c,
                w_c,
                b_c,
                x.shape[0],
                self.w.shape[1],
                x.shape[1],
                run_bias=0,
                run_activation=0,
            )
            relu = LeakyReLU()
            out = out.reshape(self.w.shape[1], x.shape[0]).T
            check = xp.matmul(x, self.w) + self.b
            check2 = relu(check)
            import pdb

            pdb.set_trace()
            """
        return xp.matmul(x, self.w) + self.b


class NN:
    def __init__(
        self, input_str="SE_n30_", folder="few/files/weights/", activation_kwargs={}
    ):
        self.layers = []
        file_list = os.listdir(folder)

        # get highest layer number
        self.num_layers = 0
        for fp in file_list:
            layer_num = int(fp.split(input_str)[1][1:].split(".")[0])
            if layer_num > self.num_layers:
                self.num_layers = layer_num

        for i in range(1, self.num_layers + 1):
            temp = {}
            for let in ["w", "b"]:
                mat = np.genfromtxt(folder + input_str + let + str(i) + ".txt")
                temp[let] = xp.asarray(mat, dtype=xp.float64)

            self.layers.append(Linear(temp["w"], temp["b"]))

        self.activation = LeakyReLU(**activation_kwargs)

        print("Number of layers:", self.num_layers)

    def __call__(self, x_in):
        x = x_in.copy()
        for i, layer in enumerate(self.layers):
            x = layer(x)

            if i < self.num_layers - 1:
                x = self.activation(x)

        import pdb

        pdb.set_trace()
        return x


if __name__ == "__main__":
    import pdb

    num_test = 10

    test_vals = xp.array(
        [
            [
                0.000000000000000000e00,
                1.400000000000000000e01,
                1.000000000000000056e-01,
                0.000000000000000000e00,
                0.000000000000000000e00,
            ],
            [
                4.925491025543576318e-01,
                1.399999946870821077e01,
                9.999999402038706187e-02,
                1.885744974439321556e-02,
                1.425322113793254727e-02,
            ],
            [
                2.955294615326145902e00,
                1.399999681224823433e01,
                9.999996412230920118e-02,
                1.131447150264580093e-01,
                8.551933630148189636e-02,
            ],
            [
                1.286370855922915801e01,
                1.399998612444166213e01,
                9.999984383254550968e-02,
                4.924928596410985127e-01,
                3.722459016356379768e-01,
            ],
            [
                5.168638148867539428e01,
                1.399994424772283175e01,
                9.999937251554522066e-02,
                1.978840894800699690e00,
                1.495686659171679089e00,
            ],
            [
                2.032778422921496144e02,
                1.399978072700977094e01,
                9.999753210512817014e-02,
                7.782671563517693514e00,
                5.882439849076598115e00,
            ],
            [
                7.024557710267299626e02,
                1.399924222119750361e01,
                9.999147120376664089e-02,
                2.689493698799578425e01,
                2.032807199988250346e01,
            ],
            [
                2.448387450286361855e03,
                1.399735818215762251e01,
                9.997026548351774233e-02,
                9.375118618375719848e01,
                7.085842083848200446e01,
            ],
            [
                9.016518419467991407e03,
                1.399026277159548570e01,
                9.989039410146839659e-02,
                3.453864233599038016e02,
                2.610229324953601235e02,
            ],
            [
                3.181483106840585606e04,
                1.396553903500634952e01,
                9.961208475763561054e-02,
                1.220358314784358754e03,
                9.219697767448785726e02,
            ],
            [
                5.849287055341897212e04,
                1.393641852739430753e01,
                9.928482614142118690e-02,
                2.247278214853609825e03,
                1.697133777718755255e03,
            ],
            [
                1.093891869072637637e05,
                1.388028514407749370e01,
                9.865693097323248451e-02,
                4.215694071682573849e03,
                3.181260993922382113e03,
            ],
            [
                1.624742517650428053e05,
                1.382090713415828809e01,
                9.799620362960058395e-02,
                6.281969183913000961e03,
                4.736704661082257189e03,
            ],
            [
                2.155593166228218470e05,
                1.376065117931368675e01,
                9.732890858978311688e-02,
                8.362068313950860102e03,
                6.299956881684228392e03,
            ],
            [
                2.898135953808018821e05,
                1.367483231064686144e01,
                9.638306001129083589e-02,
                1.129554195420394535e04,
                8.500019556646850106e03,
            ],
            [
                3.685819260736810975e05,
                1.358174514321080650e01,
                9.536152666158678737e-02,
                1.443883329477733241e04,
                1.085141958680377502e04,
            ],
            [
                5.093100772586946259e05,
                1.340979284418851591e01,
                9.348018277176835256e-02,
                2.013952158418566250e04,
                1.509943898257777983e04,
            ],
            [
                5.931344153784140944e05,
                1.330366145374089903e01,
                9.231855193652922786e-02,
                2.358970005527477770e04,
                1.765969003803039232e04,
            ],
            [
                6.410047529735076241e05,
                1.324171972399717667e01,
                9.163929521669574030e-02,
                2.557924606417166433e04,
                1.913224045158541048e04,
            ],
            [
                6.766452952606141334e05,
                1.319494497570416769e01,
                9.112543319305617395e-02,
                2.706987720615278522e04,
                2.023364840656465094e04,
            ],
            [
                7.136287124010053230e05,
                1.314579447110541999e01,
                9.058454780259948824e-02,
                2.862532983853060432e04,
                2.138121110146208594e04,
            ],
            [
                7.506121295413966291e05,
                1.309599961079008779e01,
                9.003514745673461828e-02,
                3.018979490372865985e04,
                2.253360038597913444e04,
            ],
            [
                7.878227211620969465e05,
                1.304522944408241081e01,
                8.947551501977088484e-02,
                3.177317326565777330e04,
                2.369802920170898869e04,
            ],
            [
                8.297228614507478196e05,
                1.298723170907019409e01,
                8.883920163441240414e-02,
                3.356754063582501112e04,
                2.501527942151849857e04,
            ],
            [
                8.778879994648158317e05,
                1.291943533584204928e01,
                8.809899211119762152e-02,
                3.564558256686700770e04,
                2.653760528405769219e04,
            ],
            [
                9.284591061169042950e05,
                1.284689893756302403e01,
                8.731051184218725780e-02,
                3.784566999973592465e04,
                2.814554676822656256e04,
            ],
            [
                1.020295745418177103e06,
                1.271140962913949402e01,
                8.584390197370980746e-02,
                4.189085296268173988e04,
                3.109148101009591119e04,
            ],
            [
                1.106962121329144575e06,
                1.257874947571975177e01,
                8.441031337512229504e-02,
                4.577046188282317598e04,
                3.390354454016099771e04,
            ],
            [
                1.155774017433728790e06,
                1.250181799930973270e01,
                8.357775820807869516e-02,
                4.798357731558126397e04,
                3.550161312424612697e04,
            ],
            [
                1.194941632638065843e06,
                1.243885934940354510e01,
                8.289491773709189992e-02,
                4.977469362956796977e04,
                3.679162758309214405e04,
            ],
            [
                1.225655772106371121e06,
                1.238869087183407025e01,
                8.234961517339804693e-02,
                5.118904199058526865e04,
                3.780812776883049082e04,
            ],
            [
                1.258390489105260698e06,
                1.233441955486340902e01,
                8.175818763454480165e-02,
                5.270618396394451702e04,
                3.889634942731203046e04,
            ],
            [
                1.288217982317417394e06,
                1.228422238000027811e01,
                8.121137759078057849e-02,
                5.409756716888026858e04,
                3.989236675313548767e04,
            ],
            [
                1.325081474140383070e06,
                1.222116492239862495e01,
                8.052745967057967080e-02,
                5.582932181880703138e04,
                4.112931065328646218e04,
            ],
            [
                1.361944965963348979e06,
                1.215693306731401080e01,
                7.983357530670698310e-02,
                5.757491271649512782e04,
                4.237300944330246421e04,
            ],
            [
                1.398953674487889046e06,
                1.209121207624336769e01,
                7.912576984231675659e-02,
                5.934174690765299601e04,
                4.362856873199639085e04,
            ],
            [
                1.439292758769499371e06,
                1.201809665151260909e01,
                7.833988634838351395e-02,
                6.128453416505020868e04,
                4.500526448089654150e04,
            ],
            [
                1.498150536880996544e06,
                1.190847620170237597e01,
                7.716227196279015765e-02,
                6.415228347510415188e04,
                4.702970307554892497e04,
            ],
            [
                1.535782598481465597e06,
                1.183644362050391940e01,
                7.638734759283416498e-02,
                6.600731888115641777e04,
                4.833418102294905839e04,
            ],
            [
                1.568698468299837084e06,
                1.177211813429232556e01,
                7.569377233806534599e-02,
                6.764419621947139967e04,
                4.948184596265436267e04,
            ],
            [
                1.601955532570688054e06,
                1.170581055621467748e01,
                7.497663463476740564e-02,
                6.931209527014104242e04,
                5.064789278204492439e04,
            ],
            [
                1.626981136245638132e06,
                1.165500338887806997e01,
                7.442622921496502841e-02,
                7.057678457412389980e04,
                5.152973022820300685e04,
            ],
            [
                1.652120295970011968e06,
                1.160314490824232969e01,
                7.386558950662869272e-02,
                7.185577142110366549e04,
                5.241945520549796493e04,
            ],
            [
                1.680013948991991347e06,
                1.154460218082275169e01,
                7.323468760990285709e-02,
                7.328522296305095369e04,
                5.341131962901214138e04,
            ],
            [
                1.708984709434357472e06,
                1.148263286780600012e01,
                7.256856027244283636e-02,
                7.478172619331839087e04,
                5.444678028087862913e04,
            ],
            [
                1.742561504176196177e06,
                1.140924896364330543e01,
                7.178099967228226963e-02,
                7.653179633218192612e04,
                5.565378687495893246e04,
            ],
            [
                1.783611029738524929e06,
                1.131711614064614402e01,
                7.079233257630633547e-02,
                7.869511374518569210e04,
                5.713980852498640888e04,
            ],
            [
                1.811914150027374038e06,
                1.125194673767642861e01,
                7.009188941022369279e-02,
                8.020256363783027336e04,
                5.817125589227084856e04,
            ],
            [
                1.833168774806604255e06,
                1.120207444911851802e01,
                6.955475163700849950e-02,
                8.134344837595078570e04,
                5.894961250236547494e04,
            ],
            [
                1.855379672250809846e06,
                1.114906456455707939e01,
                6.898231633013639230e-02,
                8.254402282470605860e04,
                5.976652472909750213e04,
            ],
            [
                1.874549334700978361e06,
                1.110254888689818209e01,
                6.847905784188947076e-02,
                8.358726947519427631e04,
                6.047454241818970331e04,
            ],
            [
                1.896147626905118581e06,
                1.104925689586196569e01,
                6.790300605252172494e-02,
                8.477075002459634561e04,
                6.127561127948700596e04,
            ],
            [
                1.918800029355988139e06,
                1.099231526141503323e01,
                6.728900416607432045e-02,
                8.602144252503801545e04,
                6.211966791086209560e04,
            ],
            [
                1.947533684195645619e06,
                1.091846217849997203e01,
                6.649420032216458998e-02,
                8.762230734822066734e04,
                6.319618561844794749e04,
            ],
            [
                1.981539958976871334e06,
                1.082856043366409793e01,
                6.552722892984189085e-02,
                8.953864447810572165e04,
                6.447895813854322478e04,
            ],
            [
                2.001617431334787281e06,
                1.077413089671699709e01,
                6.494112757852414652e-02,
                9.068158204170616227e04,
                6.524087126986030489e04,
            ],
            [
                2.019218044187348103e06,
                1.072554439376038360e01,
                6.441703087604622180e-02,
                9.169082555259515357e04,
                6.591164249751639727e04,
            ],
            [
                2.033949873729331652e06,
                1.068422464663778904e01,
                6.397045813359961142e-02,
                9.254096509727642115e04,
                6.647516775237074762e04,
            ],
            [
                2.048681703271315433e06,
                1.064228709312386023e01,
                6.351594886335842904e-02,
                9.339615055125972140e04,
                6.704062461879383773e04,
            ],
            [
                2.064045769846841926e06,
                1.059786708134944533e01,
                6.303399159058491186e-02,
                9.429354972673457814e04,
                6.763243929101336107e04,
            ],
            [
                2.089291988968343940e06,
                1.052329060927061732e01,
                6.222609470920410779e-02,
                9.578077242384038982e04,
                6.860963567160653474e04,
            ],
            [
                2.116914708928043954e06,
                1.043929598660149694e01,
                6.131776058153433351e-02,
                9.742670537703533773e04,
                6.968571932992879010e04,
            ],
            [
                2.139720370368566364e06,
                1.036792562331615208e01,
                6.054583092162822699e-02,
                9.880104379823194176e04,
                7.057973452784986875e04,
            ],
            [
                2.163834438998976722e06,
                1.029032384017965995e01,
                5.970482653103755671e-02,
                1.002701546136894176e05,
                7.153069278981919342e04,
            ],
            [
                2.187948507629386615e06,
                1.021036511045486428e01,
                5.883492526443352688e-02,
                1.017564234069472877e05,
                7.248761903204581176e04,
            ],
            [
                2.198445492950065527e06,
                1.017477673748187073e01,
                5.844677823299585656e-02,
                1.024089845502846729e05,
                7.290608114063272660e04,
            ],
            [
                2.209358206496661995e06,
                1.013725147709455854e01,
                5.803751858007708680e-02,
                1.030910958382818935e05,
                7.334236433559350553e04,
            ],
            [
                2.228380787555564661e06,
                1.007049535506984839e01,
                5.731009306821561317e-02,
                1.042894257893178146e05,
                7.410596507001551799e04,
            ],
            [
                2.247653182048410177e06,
                1.000102108554825797e01,
                5.655316096666945791e-02,
                1.055160025822449388e05,
                7.488367704943403078e04,
            ],
            [
                2.266925576541255228e06,
                9.929563663521689065e00,
                5.577340949118669844e-02,
                1.067557450671912229e05,
                7.566559335382439895e04,
            ],
            [
                2.281000871031755116e06,
                9.876039784383584319e00,
                5.518786154524318865e-02,
                1.076698494645516766e05,
                7.623936630496245925e04,
            ],
            [
                2.293383137817133684e06,
                9.827965940857906091e00,
                5.466021690696012264e-02,
                1.084802929840071301e05,
                7.674605161175313697e04,
            ],
            [
                2.309160811126299668e06,
                9.765293602305645138e00,
                5.397093533653853775e-02,
                1.095218197142089339e05,
                7.739433644161092525e04,
            ],
            [
                2.321640148336037993e06,
                9.714535969793436365e00,
                5.341283141513838983e-02,
                1.103528934819517017e05,
                7.790924085361797188e04,
            ],
            [
                2.335040537763157859e06,
                9.658794583200917216e00,
                5.279979874859146854e-02,
                1.112527418359699805e05,
                7.846429145422414877e04,
            ],
            [
                2.351349083200852852e06,
                9.589117382533794753e00,
                5.203228092189032816e-02,
                1.123586879886044044e05,
                7.914284222666664573e04,
            ],
            [
                2.367657628638547380e06,
                9.517275190039571342e00,
                5.123820682947088923e-02,
                1.134770539560525067e05,
                7.982479217056042398e04,
            ],
            [
                2.378750474927024450e06,
                9.467083814574563050e00,
                5.068143080654088917e-02,
                1.142451706868636684e05,
                8.029061871062533464e04,
            ],
            [
                2.391610486525130458e06,
                9.407461988937422248e00,
                5.001903519030508061e-02,
                1.151434998342942854e05,
                8.083268314597783319e04,
            ],
            [
                2.403079212954656687e06,
                9.352909878682202915e00,
                4.941256277194801261e-02,
                1.159520303829269542e05,
                8.131796260377200088e04,
            ],
            [
                2.416781021686783060e06,
                9.285909680799877108e00,
                4.866639597814814006e-02,
                1.169275273011987447e05,
                8.190005672828920069e04,
            ],
            [
                2.430482830418909434e06,
                9.216771804399611412e00,
                4.789367052683917575e-02,
                1.179138966020083462e05,
                8.248471093424918945e04,
            ],
            [
                2.442562644882500637e06,
                9.153903762008933853e00,
                4.718808320839332215e-02,
                1.187929692042889947e05,
                8.300229929494007956e04,
            ],
            [
                2.452376113445437979e06,
                9.101411034973736491e00,
                4.659779097364790540e-02,
                1.195139520536831988e05,
                8.342427086032833904e04,
            ],
            [
                2.462525655956853181e06,
                9.045687598936268614e00,
                4.597026975857764625e-02,
                1.202663554053535336e05,
                8.386210556444997201e04,
            ],
            [
                2.476089966656192672e06,
                8.968764346855534697e00,
                4.510125789932843687e-02,
                1.212830970034080965e05,
                8.444949636398983421e04,
            ],
            [
                2.486469909754269756e06,
                8.907848123326475687e00,
                4.440984177431302193e-02,
                1.220702379292530095e05,
                8.490072879836328502e04,
            ],
            [
                2.497639206895794254e06,
                8.840134356522696635e00,
                4.363858773206934216e-02,
                1.229265240432664432e05,
                8.538795309500599978e04,
            ],
            [
                2.508808504037318751e06,
                8.769977687187175519e00,
                4.283728116904216010e-02,
                1.237929535834609851e05,
                8.587690290074523364e04,
            ],
            [
                2.522925159149589483e06,
                8.677444006206677329e00,
                4.177473305641538764e-02,
                1.249034492081468925e05,
                8.649730767505566473e04,
            ],
            [
                2.530085940706131049e06,
                8.628693454171100896e00,
                4.121204667652943188e-02,
                1.254737336679642613e05,
                8.681302839934411168e04,
            ],
            [
                2.537246722262673080e06,
                8.578612475544407090e00,
                4.063258995216555841e-02,
                1.260489692302328331e05,
                8.712941468153306050e04,
            ],
            [
                2.544407503819215111e06,
                8.527105223072830142e00,
                4.003482683247919227e-02,
                1.266293681808851397e05,
                8.744644850255559140e04,
            ],
            [
                2.550243104967676569e06,
                8.484000912428898644e00,
                3.953274267588831326e-02,
                1.271063358870047232e05,
                8.770527529487178253e04,
            ],
            [
                2.556143619248892646e06,
                8.439315339880485212e00,
                3.901025248827300757e-02,
                1.275923888545308437e05,
                8.796738851031353988e04,
            ],
            [
                2.562054427345117088e06,
                8.393366673267671274e00,
                3.847126724468492853e-02,
                1.280832503580947814e05,
                8.823035173210153880e04,
            ],
            [
                2.570301586176945362e06,
                8.327114526274929318e00,
                3.769120046307607858e-02,
                1.287750680020183208e05,
                8.859787153774649778e04,
            ],
            [
                2.577452212166765239e06,
                8.267469664892823644e00,
                3.698508853374800343e-02,
                1.293817828518810420e05,
                8.891705690228512685e04,
            ],
            [
                2.582907135309469420e06,
                8.220466598727112384e00,
                3.642587403365825371e-02,
                1.298491477824928006e05,
                8.916084477080433862e04,
            ],
            [
                2.588751508321385365e06,
                8.168540020784915257e00,
                3.580573123817259312e-02,
                1.303544429549458437e05,
                8.942228205626374984e04,
            ],
            [
                2.594595881333300844e06,
                8.114853872240596289e00,
                3.516157919835066065e-02,
                1.308646868581052113e05,
                8.968392816057415621e04,
            ],
            [
                2.598634930586859584e06,
                8.076639345302739414e00,
                3.470081600335937072e-02,
                1.312203422355782241e05,
                8.986484629929323273e04,
            ],
            [
                2.602840816915232223e06,
                8.035806566771533710e00,
                3.420657918832177569e-02,
                1.315934300156284589e05,
                9.005329436616922612e04,
            ],
            [
                2.609832669631055091e06,
                7.965371559533452661e00,
                3.334958008257982165e-02,
                1.322201453167478030e05,
                9.036662601392420765e04,
            ],
            [
                2.613867820945048239e06,
                7.923135374748396131e00,
                3.283244440970656264e-02,
                1.325857182136415504e05,
                9.054744037411468162e04,
            ],
            [
                2.619279937880394980e06,
                7.864468773767927523e00,
                3.211008623355330466e-02,
                1.330807628838437086e05,
                9.078986673206093838e04,
            ],
            [
                2.624692054815741722e06,
                7.803251480800756035e00,
                3.135135264778491498e-02,
                1.335815240510310978e05,
                9.103210157893317228e04,
            ],
            [
                2.630385711350873113e06,
                7.735755290547870366e00,
                3.050797788529322277e-02,
                1.341149179237578646e05,
                9.128660205624588707e04,
            ],
            [
                2.635131593428808730e06,
                7.676759317083246437e00,
                2.976504541890982389e-02,
                1.345650339286966191e05,
                9.149835650972975418e04,
            ],
            [
                2.638872215823688079e06,
                7.628291885663691652e00,
                2.915019239563891584e-02,
                1.349235696276480448e05,
                9.166493054342357209e04,
            ],
            [
                2.642882445170228835e06,
                7.574179943048975794e00,
                2.845879478101881813e-02,
                1.353118566375732771e05,
                9.184310360646714980e04,
            ],
            [
                2.646763467909059022e06,
                7.519444363666255349e00,
                2.775385555542856167e-02,
                1.356917204025137762e05,
                9.201503983645772678e04,
            ],
            [
                2.650776570393397938e06,
                7.460080505273420037e00,
                2.698251897561801740e-02,
                1.360890218868958182e05,
                9.219219251314619032e04,
            ],
            [
                2.655225538252591621e06,
                7.390497776895860405e00,
                2.606892361056517560e-02,
                1.365352361400953087e05,
                9.238764683531207265e04,
            ],
            [
                2.659152507871323731e06,
                7.325246405829842544e00,
                2.520211362988308834e-02,
                1.369345417720692349e05,
                9.255914609806615044e04,
            ],
            [
                2.662600709739862476e06,
                7.264477133869786663e00,
                2.438543920847385457e-02,
                1.372897340911198116e05,
                9.270875806989478588e04,
            ],
            [
                2.666629041757127736e06,
                7.188601115011224785e00,
                2.335190662054125593e-02,
                1.377105877165104903e05,
                9.288210535314421577e04,
            ],
            [
                2.670224895653823856e06,
                7.115511254696767374e00,
                2.234044307204792121e-02,
                1.380921601905225252e05,
                9.303521644522908900e04,
            ],
            [
                2.673281690541522112e06,
                7.048505856409902570e00,
                2.139817182197224776e-02,
                1.384213711861001502e05,
                9.316386761751158338e04,
            ],
            [
                2.676367389001634903e06,
                6.975246542148747508e00,
                2.034966228735056448e-02,
                1.387586993092641642e05,
                9.329198554838268319e04,
            ],
            [
                2.679036832297690678e06,
                6.906178645479712053e00,
                1.934185901239093494e-02,
                1.390550342463435372e05,
                9.340105830469324428e04,
            ],
            [
                2.681076273294384126e06,
                6.848951052001877926e00,
                1.849096342363922701e-02,
                1.392845705496798910e05,
                9.348303003061277559e04,
            ],
            [
                2.683154672855772544e06,
                6.785629299619434285e00,
                1.753076133901056502e-02,
                1.395216022397727356e05,
                9.356508231020014500e04,
            ],
            [
                2.684525077711364254e06,
                6.740456507264071639e00,
                1.683250792878334887e-02,
                1.396797849199185730e05,
                9.361819922931551991e04,
            ],
            [
                2.685907416051923763e06,
                6.691468816871132042e00,
                1.606144154321387935e-02,
                1.398410269333299075e05,
                9.367083074046757247e04,
            ],
            [
                2.687324844959022943e06,
                6.636794970824857032e00,
                1.518193839708823455e-02,
                1.400082944361834670e05,
                9.372362153188000957e04,
            ],
            [
                2.688454966193025932e06,
                6.589111990133681651e00,
                1.439656391870184141e-02,
                1.401432130872534181e05,
                9.376468572169978870e04,
            ],
            [
                2.689585087427028455e06,
                6.536706172321179231e00,
                1.351099446142558884e-02,
                1.402796771177894552e05,
                9.380464186344224436e04,
            ],
            [
                2.690715208661031444e06,
                6.477959106287829449e00,
                1.248600130593279997e-02,
                1.404178903011060902e05,
                9.384322786428885593e04,
            ],
            [
                2.691552893281352241e06,
                6.428738731645291082e00,
                1.159634134269794774e-02,
                1.405216312187218573e05,
                9.387071804635804438e04,
            ],
            [
                2.692223198044459336e06,
                6.384444486507758754e00,
                1.076723987532060729e-02,
                1.406055555727745814e05,
                9.389185507968721504e04,
            ],
            [
                2.692802540910195094e06,
                6.341199009801294473e00,
                9.926876941758156978e-03,
                1.406788410918221634e05,
                9.390935117854464625e04,
            ],
            [
                2.693307802888293751e06,
                6.298051889806157710e00,
                9.052155764833978366e-03,
                1.407434115550284914e05,
                9.392387023158288503e04,
            ],
            [
                2.693700733925721142e06,
                6.259285096849782626e00,
                8.228133379334163361e-03,
                1.407941193744769553e05,
                9.393455106567234907e04,
            ],
            [
                2.693914043036652263e06,
                6.235446611099860093e00,
                7.699981332645223706e-03,
                1.408218558670986386e05,
                9.394006736876345531e04,
            ],
            [
                2.694207595362714492e06,
                6.197791459927289637e00,
                6.827672718225953445e-03,
                1.408603066544090107e05,
                9.394724502324375499e04,
            ],
            [
                2.694324130281369668e06,
                6.180598747832948270e00,
                6.409808114064070167e-03,
                1.408756740023515013e05,
                9.394992999759163649e04,
            ],
            [
                2.694440665200025309e06,
                6.161531437343363393e00,
                5.926673687713262563e-03,
                1.408911089282738394e05,
                9.395249824204527249e04,
            ],
            [
                2.694546381993841380e06,
                6.141978805482414927e00,
                5.406962572511777969e-03,
                1.409051768386756594e05,
                9.395470653126756952e04,
            ],
        ]
    )

    # e = xp.linspace(0.1, 0.5, num_test, dtype=xp.float64)
    # p = xp.linspace(7.0, 11.0, num_test, dtype=xp.float64)
    e = test_vals[:, 2]
    p = test_vals[:, 1]

    test = xp.asarray([p, e], dtype=xp.float64).T
    check = NN()

    out = check(test)
    import pdb

    pdb.set_trace()
    import time

    for j in range(100):
        st = time.perf_counter()
        for i in range(10):
            out = check(test)
        et = time.perf_counter()
        print((et - st) / 10)
    pdb.set_trace()
